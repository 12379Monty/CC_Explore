<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 4 Compare Predictive Models | Classification and Clustering: Case Study with CRC Gene Expression Data</title>
  <meta name="description" content="Classification and clustering methodes are explored using colorectal data from GEO website" />
  <meta name="generator" content="bookdown 0.20.6 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 4 Compare Predictive Models | Classification and Clustering: Case Study with CRC Gene Expression Data" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Classification and clustering methodes are explored using colorectal data from GEO website" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 4 Compare Predictive Models | Classification and Clustering: Case Study with CRC Gene Expression Data" />
  
  <meta name="twitter:description" content="Classification and clustering methodes are explored using colorectal data from GEO website" />
  

<meta name="author" content="Francois Collin" />


<meta name="date" content="2020-01-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="train-models.html"/>
<link rel="next" href="clustering.html"/>
<script src="libs/header-attrs-2.4/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script type="text/javascript">
// source:https://stackoverflow.com/questions/45360998/code-folding-in-bookdown
// toggle visibility of R source blocks in R Markdown output
function toggle_R() {
  var x = document.getElementsByClassName('r');
  if (x.length == 0) return;
  function toggle_vis(o) {
    var d = o.style.display;
    o.style.display = (d == 'block' || d == '') ? 'none':'block';
  }

  for (i = 0; i < x.length; i++) {
    var y = x[i];
    if (y.tagName.toLowerCase() === 'pre') toggle_vis(y);
  }

    var elem = document.getElementById("myButton1");
    if (elem.value === "Hide Global") elem.value = "Show Global";
    else elem.value = "Hide Global";
}

document.write('<input onclick="toggle_R();" type="button" value="Hide Global" id="myButton1" style="position: absolute; top: 10%; right: 2%; z-index: 200"></input>')

</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preamble</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#outline"><i class="fa fa-check"></i><b>1.1</b> Outline</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#data-preprocessing"><i class="fa fa-check"></i><b>1.2</b> Data Preprocessing</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#affymetrix-probe-sets-vs-genes"><i class="fa fa-check"></i><b>1.3</b> Affymetrix Probe Sets vs Genes</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#building-a-classifier"><i class="fa fa-check"></i><b>1.4</b> Building a Classifier</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#classifier-assessment"><i class="fa fa-check"></i><b>1.5</b> Classifier Assessment</a></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#subclass-discovery"><i class="fa fa-check"></i><b>1.6</b> Subclass Discovery</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="load-data.html"><a href="load-data.html"><i class="fa fa-check"></i><b>2</b> Load Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="load-data.html"><a href="load-data.html#download-datasets"><i class="fa fa-check"></i><b>2.1</b> Download Datasets</a></li>
<li class="chapter" data-level="2.2" data-path="load-data.html"><a href="load-data.html#peek-into-datasets"><i class="fa fa-check"></i><b>2.2</b> Peek into Datasets</a></li>
<li class="chapter" data-level="2.3" data-path="load-data.html"><a href="load-data.html#dataset-cleaning"><i class="fa fa-check"></i><b>2.3</b> Dataset Cleaning</a></li>
<li class="chapter" data-level="2.4" data-path="load-data.html"><a href="load-data.html#data-pooling"><i class="fa fa-check"></i><b>2.4</b> Data Pooling</a></li>
<li class="chapter" data-level="2.5" data-path="load-data.html"><a href="load-data.html#batch-correction"><i class="fa fa-check"></i><b>2.5</b> Batch Correction</a></li>
<li class="chapter" data-level="2.6" data-path="load-data.html"><a href="load-data.html#separate-data-set-into-train-and-test-subsets"><i class="fa fa-check"></i><b>2.6</b> Separate Data Set into Train and Test Subsets</a></li>
<li class="chapter" data-level="2.7" data-path="load-data.html"><a href="load-data.html#save-gene-sets"><i class="fa fa-check"></i><b>2.7</b> Save Gene Sets</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="train-models.html"><a href="train-models.html"><i class="fa fa-check"></i><b>3</b> Train Predictive Modesl</a>
<ul>
<li class="chapter" data-level="3.1" data-path="train-models.html"><a href="train-models.html#knn---k-nearest-neighbors"><i class="fa fa-check"></i><b>3.1</b> knn - k nearest neighbors</a></li>
<li class="chapter" data-level="3.2" data-path="train-models.html"><a href="train-models.html#rf---random-forests"><i class="fa fa-check"></i><b>3.2</b> rf - Random forests</a></li>
<li class="chapter" data-level="3.3" data-path="train-models.html"><a href="train-models.html#svmradial---support-vector-machines-rbf-kernel"><i class="fa fa-check"></i><b>3.3</b> svmRadial - Support vector machines (RBF kernel)</a></li>
<li class="chapter" data-level="3.4" data-path="train-models.html"><a href="train-models.html#gbm---boosted-trees"><i class="fa fa-check"></i><b>3.4</b> gbm - Boosted trees</a></li>
<li class="chapter" data-level="3.5" data-path="train-models.html"><a href="train-models.html#xgblinear---extreme-gradient-boosting"><i class="fa fa-check"></i><b>3.5</b> xgbLinear - eXtreme Gradient Boosting</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="comp-models.html"><a href="comp-models.html"><i class="fa fa-check"></i><b>4</b> Compare Predictive Models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="comp-models.html"><a href="comp-models.html#load-models"><i class="fa fa-check"></i><b>4.1</b> Load Models</a></li>
<li class="chapter" data-level="4.2" data-path="comp-models.html"><a href="comp-models.html#compare-times"><i class="fa fa-check"></i><b>4.2</b> Compare Times</a></li>
<li class="chapter" data-level="4.3" data-path="comp-models.html"><a href="comp-models.html#compare-prediction-accuracy"><i class="fa fa-check"></i><b>4.3</b> Compare Prediction Accuracy</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="comp-models.html"><a href="comp-models.html#train-data-accuracy"><i class="fa fa-check"></i><b>4.3.1</b> Train Data Accuracy</a></li>
<li class="chapter" data-level="4.3.2" data-path="comp-models.html"><a href="comp-models.html#out-of-sample-train-data-accuracy"><i class="fa fa-check"></i><b>4.3.2</b> Out of Sample Train Data Accuracy</a></li>
<li class="chapter" data-level="4.3.3" data-path="comp-models.html"><a href="comp-models.html#test-data-accuracy"><i class="fa fa-check"></i><b>4.3.3</b> Test Data Accuracy</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="comp-models.html"><a href="comp-models.html#compare-models-in-terms-of-roc"><i class="fa fa-check"></i><b>4.4</b> Compare Models in Terms of ROC</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="comp-models.html"><a href="comp-models.html#training-data-roc"><i class="fa fa-check"></i><b>4.4.1</b> Training Data ROC</a></li>
<li class="chapter" data-level="4.4.2" data-path="comp-models.html"><a href="comp-models.html#out-of-sample-train-average-over-repeats"><i class="fa fa-check"></i><b>4.4.2</b> Out-of-sample Train: Average over Repeats</a></li>
<li class="chapter" data-level="4.4.3" data-path="comp-models.html"><a href="comp-models.html#out-of-sample-set.train-individual-repeats"><i class="fa fa-check"></i><b>4.4.3</b> Out-of-sample Set.Train: Individual Repeats</a></li>
<li class="chapter" data-level="4.4.4" data-path="comp-models.html"><a href="comp-models.html#compare-predicted-probabilities"><i class="fa fa-check"></i><b>4.4.4</b> Compare Predicted Probabilities</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="comp-models.html"><a href="comp-models.html#look-at-variable-importance"><i class="fa fa-check"></i><b>4.5</b> Look at Variable Importance</a></li>
<li class="chapter" data-level="4.6" data-path="comp-models.html"><a href="comp-models.html#classification-discussion"><i class="fa fa-check"></i><b>4.6</b> Classification: Discussion</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="comp-models.html"><a href="comp-models.html#nearest-shrunken-centroids-does-well"><i class="fa fa-check"></i><b>4.6.1</b> Nearest shrunken centroids does well</a></li>
<li class="chapter" data-level="4.6.2" data-path="comp-models.html"><a href="comp-models.html#lack-of-agreement-with-literature-gene-sets"><i class="fa fa-check"></i><b>4.6.2</b> Lack of agreement with literature gene sets</a></li>
<li class="chapter" data-level="4.6.3" data-path="comp-models.html"><a href="comp-models.html#models-could-be-better-optimized"><i class="fa fa-check"></i><b>4.6.3</b> Models could be better optimized</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="clustering.html"><a href="clustering.html"><i class="fa fa-check"></i><b>5</b> Cluster Analysis</a>
<ul>
<li class="chapter" data-level="5.1" data-path="clustering.html"><a href="clustering.html#pam-clustering"><i class="fa fa-check"></i><b>5.1</b> PAM Clustering</a></li>
<li class="chapter" data-level="5.2" data-path="clustering.html"><a href="clustering.html#bootstrap-aggregation-of-clusters"><i class="fa fa-check"></i><b>5.2</b> Bootstrap Aggregation of Clusters</a></li>
<li class="chapter" data-level="5.3" data-path="clustering.html"><a href="clustering.html#t-sne"><i class="fa fa-check"></i><b>5.3</b> t-SNE</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="clustering.html"><a href="clustering.html#t-sne-pam"><i class="fa fa-check"></i><b>5.3.1</b> t-SNE + PAM</a></li>
<li class="chapter" data-level="5.3.2" data-path="clustering.html"><a href="clustering.html#t-sne-bagclust2"><i class="fa fa-check"></i><b>5.3.2</b> t-SNE + BagClust2</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="clustering.html"><a href="clustering.html#cluster-analysis-discussion"><i class="fa fa-check"></i><b>5.4</b> Cluster Analysis: Discussion</a></li>
<li class="chapter" data-level="5.5" data-path="clustering.html"><a href="clustering.html#next-step-look-for-subgroups-in-the-mss-population---an-open-biological-question."><i class="fa fa-check"></i><b>5.5</b> Next Step: Look for subgroups in the MSS population - an open biological question.</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>6</b> Results Summary</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Classification and Clustering: Case Study with CRC Gene Expression Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="comp-models" class="section level1" number="4">
<h1><span class="header-section-number">Section 4</span> Compare Predictive Models</h1>
<p>Here we compare predictive models in terms of:</p>
<ul>
<li>Processing time</li>
<li>Prediction accuracy and ROC on train samples</li>
<li>Prediction accuracy and ROC on train <code>out-of-sample</code></li>
<li>Prediction accuracy and ROC on test samples</li>
<li>Direct comparison of variable importance</li>
</ul>
<div id="load-models" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Load Models</h2>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="comp-models.html#cb43-1" aria-hidden="true"></a> <span class="co"># Load Train and Test Data</span></span>
<span id="cb43-2"><a href="comp-models.html#cb43-2" aria-hidden="true"></a> <span class="kw">load</span>(<span class="dt">file=</span><span class="kw">file.path</span>(WRKDIR, <span class="st">&#39;Data&#39;</span>, <span class="st">&#39;Train.Expr.mtx&#39;</span>))</span>
<span id="cb43-3"><a href="comp-models.html#cb43-3" aria-hidden="true"></a> <span class="kw">load</span>(<span class="dt">file=</span><span class="kw">file.path</span>(WRKDIR, <span class="st">&#39;Data&#39;</span>, <span class="st">&#39;Test.Expr.mtx&#39;</span>))</span>
<span id="cb43-4"><a href="comp-models.html#cb43-4" aria-hidden="true"></a> <span class="kw">load</span>(<span class="dt">file=</span><span class="kw">file.path</span>(WRKDIR, <span class="st">&#39;Data&#39;</span>, <span class="st">&#39;Train.Label.vec&#39;</span>))</span>
<span id="cb43-5"><a href="comp-models.html#cb43-5" aria-hidden="true"></a> <span class="kw">load</span>(<span class="dt">file=</span><span class="kw">file.path</span>(WRKDIR, <span class="st">&#39;Data&#39;</span>, <span class="st">&#39;Test.Label.vec&#39;</span>))</span>
<span id="cb43-6"><a href="comp-models.html#cb43-6" aria-hidden="true"></a></span>
<span id="cb43-7"><a href="comp-models.html#cb43-7" aria-hidden="true"></a> CLASS1 &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">sort</span>(<span class="kw">unique</span>(Train.Label.vec))[<span class="dv">1</span>])</span>
<span id="cb43-8"><a href="comp-models.html#cb43-8" aria-hidden="true"></a> CLASS2 &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">sort</span>(<span class="kw">unique</span>(Train.Label.vec))[<span class="dv">2</span>])</span>
<span id="cb43-9"><a href="comp-models.html#cb43-9" aria-hidden="true"></a></span>
<span id="cb43-10"><a href="comp-models.html#cb43-10" aria-hidden="true"></a> <span class="co"># Load models</span></span>
<span id="cb43-11"><a href="comp-models.html#cb43-11" aria-hidden="true"></a> ModelFit.vec &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="kw">file.path</span>(WRKDIR, <span class="st">&#39;Data&#39;</span>), <span class="st">&#39;Fit$&#39;</span>)</span>
<span id="cb43-12"><a href="comp-models.html#cb43-12" aria-hidden="true"></a></span>
<span id="cb43-13"><a href="comp-models.html#cb43-13" aria-hidden="true"></a> <span class="co"># Stratify according to batch effect correction</span></span>
<span id="cb43-14"><a href="comp-models.html#cb43-14" aria-hidden="true"></a> FitSetCV.vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">strsplit</span>(ModelFit.vec, <span class="dt">split=</span><span class="st">&#39;</span><span class="ch">\\</span><span class="st">.&#39;</span>),</span>
<span id="cb43-15"><a href="comp-models.html#cb43-15" aria-hidden="true"></a>            <span class="cf">function</span>(x) <span class="kw">paste</span>(x[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dt">collapse=</span><span class="st">&#39;.&#39;</span>))</span>
<span id="cb43-16"><a href="comp-models.html#cb43-16" aria-hidden="true"></a></span>
<span id="cb43-17"><a href="comp-models.html#cb43-17" aria-hidden="true"></a> ModelFit.lst &lt;-<span class="st"> </span><span class="kw">split</span>(<span class="kw">sapply</span>(<span class="kw">strsplit</span>(ModelFit.vec, <span class="dt">split=</span><span class="st">&#39;</span><span class="ch">\\</span><span class="st">.&#39;</span>), <span class="cf">function</span>(x) <span class="kw">rev</span>(x)[<span class="dv">1</span>]),</span>
<span id="cb43-18"><a href="comp-models.html#cb43-18" aria-hidden="true"></a>                       FitSetCV.vec)</span>
<span id="cb43-19"><a href="comp-models.html#cb43-19" aria-hidden="true"></a></span>
<span id="cb43-20"><a href="comp-models.html#cb43-20" aria-hidden="true"></a> <span class="co"># Get Model.col for plotting (only have one FitSetCV values here.  could have many)</span></span>
<span id="cb43-21"><a href="comp-models.html#cb43-21" aria-hidden="true"></a> Model.col &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.factor</span>(ModelFit.lst[[<span class="dv">1</span>]]))</span>
<span id="cb43-22"><a href="comp-models.html#cb43-22" aria-hidden="true"></a> <span class="kw">names</span>(Model.col) &lt;-<span class="st"> </span>ModelFit.lst[[<span class="dv">1</span>]]</span>
<span id="cb43-23"><a href="comp-models.html#cb43-23" aria-hidden="true"></a></span>
<span id="cb43-24"><a href="comp-models.html#cb43-24" aria-hidden="true"></a> <span class="kw">cat</span>(<span class="st">&quot;Found&quot;</span>, <span class="kw">length</span>(ModelFit.vec), <span class="st">&#39;models:</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb43-25"><a href="comp-models.html#cb43-25" aria-hidden="true"></a> <span class="kw">print</span>(ModelFit.lst)</span>
<span id="cb43-26"><a href="comp-models.html#cb43-26" aria-hidden="true"></a></span>
<span id="cb43-27"><a href="comp-models.html#cb43-27" aria-hidden="true"></a> <span class="co"># Load Models for single set (we cd have more than one set in FitSetCV.vec)</span></span>
<span id="cb43-28"><a href="comp-models.html#cb43-28" aria-hidden="true"></a> SET &lt;-<span class="st"> </span><span class="kw">names</span>(ModelFit.lst)[<span class="dv">1</span>]</span>
<span id="cb43-29"><a href="comp-models.html#cb43-29" aria-hidden="true"></a> Set.ModelFit.lst &lt;-<span class="st"> </span><span class="kw">lapply</span>(ModelFit.lst[[SET]],</span>
<span id="cb43-30"><a href="comp-models.html#cb43-30" aria-hidden="true"></a>  <span class="cf">function</span>(MF) {</span>
<span id="cb43-31"><a href="comp-models.html#cb43-31" aria-hidden="true"></a>   <span class="kw">loadObj</span>(<span class="kw">paste</span>(SET, MF, <span class="dt">sep=</span><span class="st">&#39;.&#39;</span>), <span class="st">&#39;ModelFit&#39;</span>)</span>
<span id="cb43-32"><a href="comp-models.html#cb43-32" aria-hidden="true"></a>   ModelFit})</span>
<span id="cb43-33"><a href="comp-models.html#cb43-33" aria-hidden="true"></a> <span class="kw">names</span>(Set.ModelFit.lst) &lt;-<span class="st"> </span>ModelFit.lst[[SET]]</span></code></pre></div>
<!-- ######################################################################## -->
</div>
<div id="compare-times" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Compare Times</h2>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="comp-models.html#cb44-1" aria-hidden="true"></a>  Set.ModelTimes.frm &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;rbind&#39;</span>, <span class="kw">lapply</span>(Set.ModelFit.lst,</span>
<span id="cb44-2"><a href="comp-models.html#cb44-2" aria-hidden="true"></a>  <span class="cf">function</span>(LL) <span class="kw">c</span>(<span class="dt">all=</span>LL<span class="op">$</span>times<span class="op">$</span>everything)))<span class="co">###, final=LL$times$final)))</span></span>
<span id="cb44-3"><a href="comp-models.html#cb44-3" aria-hidden="true"></a></span>
<span id="cb44-4"><a href="comp-models.html#cb44-4" aria-hidden="true"></a>  <span class="kw">print</span>(<span class="kw">kable</span>(<span class="kw">t</span>(Set.ModelTimes.frm), <span class="dt">digits=</span><span class="dv">2</span>))</span></code></pre></div>
<!-- ######################################################################## -->
</div>
<div id="compare-prediction-accuracy" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Compare Prediction Accuracy</h2>
<div id="train-data-accuracy" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Train Data Accuracy</h3>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="comp-models.html#cb45-1" aria-hidden="true"></a> <span class="kw">suppressMessages</span>(<span class="kw">require</span>(caret))</span>
<span id="cb45-2"><a href="comp-models.html#cb45-2" aria-hidden="true"></a></span>
<span id="cb45-3"><a href="comp-models.html#cb45-3" aria-hidden="true"></a> <span class="co"># Train - these are fitting errors</span></span>
<span id="cb45-4"><a href="comp-models.html#cb45-4" aria-hidden="true"></a> Set.Train.Pred.lst &lt;-<span class="st"> </span><span class="kw">suppressMessages</span>(<span class="kw">predict</span>(Set.ModelFit.lst))</span>
<span id="cb45-5"><a href="comp-models.html#cb45-5" aria-hidden="true"></a>          <span class="co">#, newdata=Train.SelGenes.Expr.mtx))</span></span>
<span id="cb45-6"><a href="comp-models.html#cb45-6" aria-hidden="true"></a></span>
<span id="cb45-7"><a href="comp-models.html#cb45-7" aria-hidden="true"></a> Set.Train.TruthTable.frm &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;rbind&#39;</span>, <span class="kw">lapply</span>(Set.Train.Pred.lst,</span>
<span id="cb45-8"><a href="comp-models.html#cb45-8" aria-hidden="true"></a> <span class="cf">function</span>(PRED) {</span>
<span id="cb45-9"><a href="comp-models.html#cb45-9" aria-hidden="true"></a>   truth.vec &lt;-<span class="st"> </span><span class="kw">as.vector</span>(<span class="kw">table</span>(PRED, Train.Label.vec))<span class="co">#/length(Train.Label.vec)</span></span>
<span id="cb45-10"><a href="comp-models.html#cb45-10" aria-hidden="true"></a>   <span class="co"># ASSUMING MSI is FIRST LABEL of CLASS</span></span>
<span id="cb45-11"><a href="comp-models.html#cb45-11" aria-hidden="true"></a>   <span class="kw">names</span>(truth.vec) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;TN&#39;</span>, <span class="st">&#39;FP&#39;</span>, <span class="st">&#39;FN&#39;</span>, <span class="st">&#39;TP&#39;</span>)</span>
<span id="cb45-12"><a href="comp-models.html#cb45-12" aria-hidden="true"></a>   truth.vec}))</span>
<span id="cb45-13"><a href="comp-models.html#cb45-13" aria-hidden="true"></a></span>
<span id="cb45-14"><a href="comp-models.html#cb45-14" aria-hidden="true"></a> <span class="kw">print</span>(</span>
<span id="cb45-15"><a href="comp-models.html#cb45-15" aria-hidden="true"></a>  <span class="kw">kable</span>(<span class="kw">data.frame</span>(<span class="kw">cbind</span>(Set.Train.TruthTable.frm,</span>
<span id="cb45-16"><a href="comp-models.html#cb45-16" aria-hidden="true"></a>                  Set.Train.TruthTable.frm<span class="op">/</span><span class="kw">length</span>(Train.Label.vec))),</span>
<span id="cb45-17"><a href="comp-models.html#cb45-17" aria-hidden="true"></a>    <span class="dt">digits=</span><span class="dv">2</span>, <span class="dt">align=</span><span class="st">&#39;c&#39;</span>)</span>
<span id="cb45-18"><a href="comp-models.html#cb45-18" aria-hidden="true"></a>  )</span></code></pre></div>
<!-- ######################################################################## -->
</div>
<div id="out-of-sample-train-data-accuracy" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Out of Sample Train Data Accuracy</h3>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="comp-models.html#cb46-1" aria-hidden="true"></a>  Set.ModelFit.osPred.mtx.lst &lt;-<span class="st"> </span><span class="kw">lapply</span>(Set.ModelFit.lst,</span>
<span id="cb46-2"><a href="comp-models.html#cb46-2" aria-hidden="true"></a> <span class="cf">function</span>(MF) {</span>
<span id="cb46-3"><a href="comp-models.html#cb46-3" aria-hidden="true"></a>   MF.pred.mtx &lt;-<span class="st"> </span>MF<span class="op">$</span>pred</span>
<span id="cb46-4"><a href="comp-models.html#cb46-4" aria-hidden="true"></a>   Rep.vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">strsplit</span>(MF<span class="op">$</span>pred<span class="op">$</span>Resample, <span class="dt">split=</span><span class="st">&#39;</span><span class="ch">\\</span><span class="st">.&#39;</span>),<span class="st">&#39;[&#39;</span>, <span class="dv">2</span>)</span>
<span id="cb46-5"><a href="comp-models.html#cb46-5" aria-hidden="true"></a>   rowIndex.vec &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">unique</span>(MF<span class="op">$</span>pred<span class="op">$</span>rowIndex))</span>
<span id="cb46-6"><a href="comp-models.html#cb46-6" aria-hidden="true"></a>   Pred.mtx &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;cbind&#39;</span>, <span class="kw">lapply</span>(<span class="kw">split</span>(MF<span class="op">$</span>pred, Rep.vec),</span>
<span id="cb46-7"><a href="comp-models.html#cb46-7" aria-hidden="true"></a>   <span class="cf">function</span>(RepMFpred.frm)</span>
<span id="cb46-8"><a href="comp-models.html#cb46-8" aria-hidden="true"></a>      <span class="kw">as.character</span>(RepMFpred.frm[<span class="kw">match</span>(rowIndex.vec, RepMFpred.frm<span class="op">$</span>rowIndex),<span class="st">&#39;pred&#39;</span>])))</span>
<span id="cb46-9"><a href="comp-models.html#cb46-9" aria-hidden="true"></a>   Pred.mtx})</span>
<span id="cb46-10"><a href="comp-models.html#cb46-10" aria-hidden="true"></a></span>
<span id="cb46-11"><a href="comp-models.html#cb46-11" aria-hidden="true"></a> <span class="co"># Use mode over reps as prediction</span></span>
<span id="cb46-12"><a href="comp-models.html#cb46-12" aria-hidden="true"></a> <span class="co">############################################</span></span>
<span id="cb46-13"><a href="comp-models.html#cb46-13" aria-hidden="true"></a> Set.ModelFit.osPred.vec.lst &lt;-<span class="st"> </span><span class="kw">lapply</span>(Set.ModelFit.osPred.mtx.lst,</span>
<span id="cb46-14"><a href="comp-models.html#cb46-14" aria-hidden="true"></a> <span class="cf">function</span>(PRED.mtx) <span class="kw">apply</span>(PRED.mtx,<span class="dv">1</span>,<span class="cf">function</span>(Pred.vec)</span>
<span id="cb46-15"><a href="comp-models.html#cb46-15" aria-hidden="true"></a> <span class="kw">names</span>(<span class="kw">table</span>(Pred.vec))[<span class="kw">which.max</span>(<span class="kw">table</span>(Pred.vec))]))</span>
<span id="cb46-16"><a href="comp-models.html#cb46-16" aria-hidden="true"></a></span>
<span id="cb46-17"><a href="comp-models.html#cb46-17" aria-hidden="true"></a> Set.Train.osPredMode.TruthTable.frm &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;rbind&#39;</span>, <span class="kw">lapply</span>(Set.ModelFit.osPred.vec.lst,</span>
<span id="cb46-18"><a href="comp-models.html#cb46-18" aria-hidden="true"></a> <span class="cf">function</span>(PRED) {</span>
<span id="cb46-19"><a href="comp-models.html#cb46-19" aria-hidden="true"></a>   truth.vec &lt;-<span class="st"> </span><span class="kw">as.vector</span>(<span class="kw">table</span>(PRED, Train.Label.vec))<span class="co">#/length(Train.Label.vec)</span></span>
<span id="cb46-20"><a href="comp-models.html#cb46-20" aria-hidden="true"></a>   <span class="co"># ASSUMING MSI is FIRST LABEL of CLASS</span></span>
<span id="cb46-21"><a href="comp-models.html#cb46-21" aria-hidden="true"></a>   <span class="kw">names</span>(truth.vec) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;TN&#39;</span>, <span class="st">&#39;FP&#39;</span>, <span class="st">&#39;FN&#39;</span>, <span class="st">&#39;TP&#39;</span>)</span>
<span id="cb46-22"><a href="comp-models.html#cb46-22" aria-hidden="true"></a>   truth.vec}))</span>
<span id="cb46-23"><a href="comp-models.html#cb46-23" aria-hidden="true"></a></span>
<span id="cb46-24"><a href="comp-models.html#cb46-24" aria-hidden="true"></a> <span class="kw">print</span>(</span>
<span id="cb46-25"><a href="comp-models.html#cb46-25" aria-hidden="true"></a> <span class="kw">kable</span>(<span class="kw">data.frame</span>(<span class="kw">cbind</span>(Set.Train.osPredMode.TruthTable.frm,</span>
<span id="cb46-26"><a href="comp-models.html#cb46-26" aria-hidden="true"></a>                  Set.Train.osPredMode.TruthTable.frm<span class="op">/</span><span class="kw">length</span>(Train.Label.vec))),</span>
<span id="cb46-27"><a href="comp-models.html#cb46-27" aria-hidden="true"></a>    <span class="dt">digits=</span><span class="dv">2</span>, <span class="dt">align=</span><span class="st">&#39;c&#39;</span>)</span>
<span id="cb46-28"><a href="comp-models.html#cb46-28" aria-hidden="true"></a> )</span>
<span id="cb46-29"><a href="comp-models.html#cb46-29" aria-hidden="true"></a></span>
<span id="cb46-30"><a href="comp-models.html#cb46-30" aria-hidden="true"></a> <span class="co">############################################</span></span>
<span id="cb46-31"><a href="comp-models.html#cb46-31" aria-hidden="true"></a> <span class="co"># alternatively, can look at the osPred by rep</span></span>
<span id="cb46-32"><a href="comp-models.html#cb46-32" aria-hidden="true"></a> <span class="co"># and use mean for error rates</span></span>
<span id="cb46-33"><a href="comp-models.html#cb46-33" aria-hidden="true"></a> <span class="co">############################################</span></span>
<span id="cb46-34"><a href="comp-models.html#cb46-34" aria-hidden="true"></a> Set.Train.osPredMean.TruthTable.frm &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;rbind&#39;</span>, <span class="kw">lapply</span>(Set.ModelFit.osPred.mtx.lst,</span>
<span id="cb46-35"><a href="comp-models.html#cb46-35" aria-hidden="true"></a>  <span class="cf">function</span>(PRED.mtx) {</span>
<span id="cb46-36"><a href="comp-models.html#cb46-36" aria-hidden="true"></a>   TruthTable.mtx &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;rbind&#39;</span>, <span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(PRED.mtx),</span>
<span id="cb46-37"><a href="comp-models.html#cb46-37" aria-hidden="true"></a>   <span class="cf">function</span>(CC) <span class="kw">as.vector</span>(<span class="kw">table</span>(PRED.mtx[,CC], Train.Label.vec)<span class="op">/</span><span class="kw">length</span>(Train.Label.vec))))</span>
<span id="cb46-38"><a href="comp-models.html#cb46-38" aria-hidden="true"></a>   <span class="kw">apply</span>(TruthTable.mtx,<span class="dv">2</span>,mean)}))</span>
<span id="cb46-39"><a href="comp-models.html#cb46-39" aria-hidden="true"></a>  <span class="kw">colnames</span>(Set.Train.osPredMean.TruthTable.frm) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;TN&#39;</span>, <span class="st">&#39;FP&#39;</span>, <span class="st">&#39;FN&#39;</span>, <span class="st">&#39;TP&#39;</span>)</span>
<span id="cb46-40"><a href="comp-models.html#cb46-40" aria-hidden="true"></a></span>
<span id="cb46-41"><a href="comp-models.html#cb46-41" aria-hidden="true"></a>  <span class="kw">print</span>(</span>
<span id="cb46-42"><a href="comp-models.html#cb46-42" aria-hidden="true"></a>    <span class="kw">kable</span>(<span class="kw">data.frame</span>(Set.Train.osPredMean.TruthTable.frm),</span>
<span id="cb46-43"><a href="comp-models.html#cb46-43" aria-hidden="true"></a>       <span class="dt">digits=</span><span class="dv">2</span>, <span class="dt">align=</span><span class="st">&#39;c&#39;</span>)</span>
<span id="cb46-44"><a href="comp-models.html#cb46-44" aria-hidden="true"></a>  )</span></code></pre></div>
<!-- ######################################################################## -->
</div>
<div id="test-data-accuracy" class="section level3" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Test Data Accuracy</h3>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="comp-models.html#cb47-1" aria-hidden="true"></a> <span class="kw">suppressMessages</span>(<span class="kw">require</span>(caret))</span>
<span id="cb47-2"><a href="comp-models.html#cb47-2" aria-hidden="true"></a></span>
<span id="cb47-3"><a href="comp-models.html#cb47-3" aria-hidden="true"></a> <span class="co"># Test - these are fitting errors</span></span>
<span id="cb47-4"><a href="comp-models.html#cb47-4" aria-hidden="true"></a> Set.Test.Pred.lst &lt;-<span class="st"> </span><span class="kw">lapply</span>(Set.ModelFit.lst,</span>
<span id="cb47-5"><a href="comp-models.html#cb47-5" aria-hidden="true"></a>          <span class="cf">function</span>(MF) <span class="kw">predict</span>(MF, <span class="dt">newdata=</span>Test.Expr.mtx))</span>
<span id="cb47-6"><a href="comp-models.html#cb47-6" aria-hidden="true"></a></span>
<span id="cb47-7"><a href="comp-models.html#cb47-7" aria-hidden="true"></a> Set.Test.TruthTable.frm &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;rbind&#39;</span>, <span class="kw">lapply</span>(Set.Test.Pred.lst,</span>
<span id="cb47-8"><a href="comp-models.html#cb47-8" aria-hidden="true"></a> <span class="cf">function</span>(PRED) {</span>
<span id="cb47-9"><a href="comp-models.html#cb47-9" aria-hidden="true"></a>   truth.vec &lt;-<span class="st"> </span><span class="kw">as.vector</span>(<span class="kw">table</span>(PRED, Test.Label.vec))<span class="co">#/length(Test.Label.vec)</span></span>
<span id="cb47-10"><a href="comp-models.html#cb47-10" aria-hidden="true"></a>   <span class="co"># ASSUMING MSI is FIRST LABEL of CLASS</span></span>
<span id="cb47-11"><a href="comp-models.html#cb47-11" aria-hidden="true"></a>   <span class="kw">names</span>(truth.vec) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;TN&#39;</span>, <span class="st">&#39;FP&#39;</span>, <span class="st">&#39;FN&#39;</span>, <span class="st">&#39;TP&#39;</span>)</span>
<span id="cb47-12"><a href="comp-models.html#cb47-12" aria-hidden="true"></a>   truth.vec}))</span>
<span id="cb47-13"><a href="comp-models.html#cb47-13" aria-hidden="true"></a></span>
<span id="cb47-14"><a href="comp-models.html#cb47-14" aria-hidden="true"></a> <span class="kw">print</span>(<span class="kw">kable</span>(<span class="kw">data.frame</span>(<span class="kw">cbind</span>(Set.Test.TruthTable.frm,</span>
<span id="cb47-15"><a href="comp-models.html#cb47-15" aria-hidden="true"></a>                  Set.Test.TruthTable.frm<span class="op">/</span><span class="kw">length</span>(Test.Label.vec))),</span>
<span id="cb47-16"><a href="comp-models.html#cb47-16" aria-hidden="true"></a>    <span class="dt">digits=</span><span class="dv">2</span>, <span class="dt">align=</span><span class="st">&#39;c&#39;</span>))</span></code></pre></div>
<!-- ######################################################################## -->
</div>
</div>
<div id="compare-models-in-terms-of-roc" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Compare Models in Terms of ROC</h2>
<div id="training-data-roc" class="section level3" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Training Data ROC</h3>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="comp-models.html#cb48-1" aria-hidden="true"></a> <span class="co"># CHANGE THIS LINE TO CLEAR CACHE</span></span>
<span id="cb48-2"><a href="comp-models.html#cb48-2" aria-hidden="true"></a> <span class="kw">suppressMessages</span>(<span class="kw">require</span>(pROC))</span>
<span id="cb48-3"><a href="comp-models.html#cb48-3" aria-hidden="true"></a></span>
<span id="cb48-4"><a href="comp-models.html#cb48-4" aria-hidden="true"></a> <span class="co">################################</span></span>
<span id="cb48-5"><a href="comp-models.html#cb48-5" aria-hidden="true"></a> <span class="co"># Train</span></span>
<span id="cb48-6"><a href="comp-models.html#cb48-6" aria-hidden="true"></a> <span class="co">################################</span></span>
<span id="cb48-7"><a href="comp-models.html#cb48-7" aria-hidden="true"></a> <span class="co"># Get predicted probabilities</span></span>
<span id="cb48-8"><a href="comp-models.html#cb48-8" aria-hidden="true"></a> Set.Train.Prob.lst &lt;-<span class="st"> </span><span class="kw">suppressMessages</span>(<span class="kw">predict</span>(Set.ModelFit.lst, <span class="dt">type=</span><span class="st">&#39;prob&#39;</span>))</span>
<span id="cb48-9"><a href="comp-models.html#cb48-9" aria-hidden="true"></a> Set.Train.ProbClass1.mtx &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;cbind&#39;</span>,</span>
<span id="cb48-10"><a href="comp-models.html#cb48-10" aria-hidden="true"></a>    <span class="kw">lapply</span>(Set.Train.Prob.lst, <span class="cf">function</span>(x) x[,CLASS1]))</span>
<span id="cb48-11"><a href="comp-models.html#cb48-11" aria-hidden="true"></a></span>
<span id="cb48-12"><a href="comp-models.html#cb48-12" aria-hidden="true"></a> <span class="kw">rownames</span>(Set.Train.ProbClass1.mtx) &lt;-<span class="st"> </span><span class="kw">names</span>(Train.Label.vec)</span>
<span id="cb48-13"><a href="comp-models.html#cb48-13" aria-hidden="true"></a></span>
<span id="cb48-14"><a href="comp-models.html#cb48-14" aria-hidden="true"></a> <span class="co"># ROC</span></span>
<span id="cb48-15"><a href="comp-models.html#cb48-15" aria-hidden="true"></a> Set.Train.roc.mtx.lst &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">colnames</span>(Set.Train.ProbClass1.mtx), <span class="cf">function</span>(MM)</span>
<span id="cb48-16"><a href="comp-models.html#cb48-16" aria-hidden="true"></a>    <span class="kw">do.call</span>(<span class="st">&#39;rbind&#39;</span>, <span class="kw">lapply</span>(<span class="kw">rev</span>(<span class="kw">sort</span>(<span class="kw">unique</span>(Set.Train.ProbClass1.mtx))),</span>
<span id="cb48-17"><a href="comp-models.html#cb48-17" aria-hidden="true"></a>     <span class="cf">function</span>(TS) {</span>
<span id="cb48-18"><a href="comp-models.html#cb48-18" aria-hidden="true"></a>        TP &lt;-<span class="st"> </span><span class="kw">sum</span>(Set.Train.ProbClass1.mtx[,MM][Train.Label.vec<span class="op">==</span>CLASS1] <span class="op">&gt;</span><span class="st"> </span>TS, <span class="dt">na.rm=</span>T)</span>
<span id="cb48-19"><a href="comp-models.html#cb48-19" aria-hidden="true"></a>        FP &lt;-<span class="st"> </span><span class="kw">sum</span>(Set.Train.ProbClass1.mtx[,MM][Train.Label.vec<span class="op">==</span>CLASS2] <span class="op">&gt;</span><span class="st"> </span>TS, <span class="dt">na.rm=</span>T)</span>
<span id="cb48-20"><a href="comp-models.html#cb48-20" aria-hidden="true"></a>        <span class="kw">c</span>(<span class="dt">TS=</span>TS, <span class="dt">TP=</span>TP, <span class="dt">FP=</span>FP)}))</span>
<span id="cb48-21"><a href="comp-models.html#cb48-21" aria-hidden="true"></a>   )</span>
<span id="cb48-22"><a href="comp-models.html#cb48-22" aria-hidden="true"></a> <span class="kw">names</span>(Set.Train.roc.mtx.lst) &lt;-<span class="st"> </span><span class="kw">colnames</span>(Set.Train.ProbClass1.mtx)</span>
<span id="cb48-23"><a href="comp-models.html#cb48-23" aria-hidden="true"></a> <span class="co"># Get auc</span></span>
<span id="cb48-24"><a href="comp-models.html#cb48-24" aria-hidden="true"></a> Set.Train.auc.vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(Set.Train.ProbClass1.mtx), <span class="cf">function</span>(CC)</span>
<span id="cb48-25"><a href="comp-models.html#cb48-25" aria-hidden="true"></a>   <span class="kw">auc</span>(Train.Label.vec, Set.Train.ProbClass1.mtx[,CC]))</span>
<span id="cb48-26"><a href="comp-models.html#cb48-26" aria-hidden="true"></a> <span class="kw">names</span>(Set.Train.auc.vec) &lt;-<span class="st"> </span><span class="kw">colnames</span>(Set.Train.ProbClass1.mtx)</span>
<span id="cb48-27"><a href="comp-models.html#cb48-27" aria-hidden="true"></a></span>
<span id="cb48-28"><a href="comp-models.html#cb48-28" aria-hidden="true"></a></span>
<span id="cb48-29"><a href="comp-models.html#cb48-29" aria-hidden="true"></a> <span class="kw">plot</span>(<span class="dt">x=</span><span class="kw">range</span>(<span class="kw">do.call</span>(<span class="st">&#39;c&#39;</span>, <span class="kw">lapply</span>(Set.Train.roc.mtx.lst,</span>
<span id="cb48-30"><a href="comp-models.html#cb48-30" aria-hidden="true"></a>                <span class="cf">function</span>(LL) LL[,<span class="st">&#39;FP&#39;</span>])))<span class="op">/</span><span class="kw">sum</span>(Train.Label.vec<span class="op">==</span>CLASS2),</span>
<span id="cb48-31"><a href="comp-models.html#cb48-31" aria-hidden="true"></a>      <span class="dt">y=</span><span class="kw">range</span>(<span class="kw">do.call</span>(<span class="st">&#39;c&#39;</span>, <span class="kw">lapply</span>(Set.Train.roc.mtx.lst,</span>
<span id="cb48-32"><a href="comp-models.html#cb48-32" aria-hidden="true"></a>                <span class="cf">function</span>(LL) LL[,<span class="st">&#39;TP&#39;</span>])))<span class="op">/</span><span class="kw">sum</span>(Train.Label.vec<span class="op">==</span>CLASS1),</span>
<span id="cb48-33"><a href="comp-models.html#cb48-33" aria-hidden="true"></a>      <span class="dt">xlab=</span><span class="st">&#39;FP&#39;</span>, <span class="dt">ylab=</span><span class="st">&#39;TP&#39;</span>, <span class="dt">type=</span><span class="st">&#39;n&#39;</span>)</span>
<span id="cb48-34"><a href="comp-models.html#cb48-34" aria-hidden="true"></a></span>
<span id="cb48-35"><a href="comp-models.html#cb48-35" aria-hidden="true"></a> <span class="cf">for</span>(II <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(Set.Train.roc.mtx.lst))</span>
<span id="cb48-36"><a href="comp-models.html#cb48-36" aria-hidden="true"></a> <span class="kw">lines</span>(<span class="dt">x=</span>Set.Train.roc.mtx.lst[[II]][,<span class="st">&#39;FP&#39;</span>]<span class="op">/</span><span class="kw">sum</span>(Train.Label.vec<span class="op">==</span>CLASS2),</span>
<span id="cb48-37"><a href="comp-models.html#cb48-37" aria-hidden="true"></a>       <span class="dt">y=</span>Set.Train.roc.mtx.lst[[II]][,<span class="st">&#39;TP&#39;</span>]<span class="op">/</span><span class="kw">sum</span>(Train.Label.vec<span class="op">==</span>CLASS1),</span>
<span id="cb48-38"><a href="comp-models.html#cb48-38" aria-hidden="true"></a>       <span class="dt">col=</span>Model.col[<span class="kw">names</span>(Set.Train.roc.mtx.lst)[II]])</span>
<span id="cb48-39"><a href="comp-models.html#cb48-39" aria-hidden="true"></a> <span class="kw">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="dt">col=</span><span class="st">&#39;grey&#39;</span>)</span>
<span id="cb48-40"><a href="comp-models.html#cb48-40" aria-hidden="true"></a> <span class="kw">legend</span>(<span class="st">&#39;bottomright&#39;</span>,</span>
<span id="cb48-41"><a href="comp-models.html#cb48-41" aria-hidden="true"></a>        <span class="dt">legend=</span><span class="kw">paste</span>(<span class="kw">names</span>(Set.Train.roc.mtx.lst), <span class="st">&#39;:&#39;</span>,</span>
<span id="cb48-42"><a href="comp-models.html#cb48-42" aria-hidden="true"></a>          <span class="kw">round</span>(Set.Train.auc.vec[<span class="kw">names</span>(Set.Train.roc.mtx.lst)],<span class="dv">3</span>),<span class="dt">sep=</span><span class="st">&#39;&#39;</span>),</span>
<span id="cb48-43"><a href="comp-models.html#cb48-43" aria-hidden="true"></a>        <span class="dt">col=</span>Model.col[<span class="kw">names</span>(Set.Train.roc.mtx.lst)],</span>
<span id="cb48-44"><a href="comp-models.html#cb48-44" aria-hidden="true"></a>        <span class="dt">lty=</span><span class="dv">1</span>)</span>
<span id="cb48-45"><a href="comp-models.html#cb48-45" aria-hidden="true"></a> <span class="kw">title</span>(<span class="st">&#39;Model Performance on Train Set&#39;</span>)</span></code></pre></div>
<!-- ######################################################################## -->
</div>
<div id="out-of-sample-train-average-over-repeats" class="section level3" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Out-of-sample Train: Average over Repeats</h3>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="comp-models.html#cb49-1" aria-hidden="true"></a> <span class="kw">suppressMessages</span>(<span class="kw">require</span>(pROC))</span>
<span id="cb49-2"><a href="comp-models.html#cb49-2" aria-hidden="true"></a> <span class="co"># Get predicted probabilities</span></span>
<span id="cb49-3"><a href="comp-models.html#cb49-3" aria-hidden="true"></a> Set.ModelFit.osProbClass1.mtx.lst &lt;-<span class="st"> </span><span class="kw">lapply</span>(Set.ModelFit.lst,</span>
<span id="cb49-4"><a href="comp-models.html#cb49-4" aria-hidden="true"></a> <span class="cf">function</span>(MF) {</span>
<span id="cb49-5"><a href="comp-models.html#cb49-5" aria-hidden="true"></a>   MF.pred.mtx &lt;-<span class="st"> </span>MF<span class="op">$</span>pred</span>
<span id="cb49-6"><a href="comp-models.html#cb49-6" aria-hidden="true"></a>   Rep.vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">strsplit</span>(MF<span class="op">$</span>pred<span class="op">$</span>Resample, <span class="dt">split=</span><span class="st">&#39;</span><span class="ch">\\</span><span class="st">.&#39;</span>),<span class="st">&#39;[&#39;</span>, <span class="dv">2</span>)</span>
<span id="cb49-7"><a href="comp-models.html#cb49-7" aria-hidden="true"></a>   rowIndex.vec &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">unique</span>(MF<span class="op">$</span>pred<span class="op">$</span>rowIndex))</span>
<span id="cb49-8"><a href="comp-models.html#cb49-8" aria-hidden="true"></a>   ProbClass1.mtx &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;cbind&#39;</span>, <span class="kw">lapply</span>(<span class="kw">split</span>(MF<span class="op">$</span>pred, Rep.vec),</span>
<span id="cb49-9"><a href="comp-models.html#cb49-9" aria-hidden="true"></a>   <span class="cf">function</span>(RepMFpred.frm)</span>
<span id="cb49-10"><a href="comp-models.html#cb49-10" aria-hidden="true"></a>      RepMFpred.frm[<span class="kw">match</span>(rowIndex.vec, RepMFpred.frm<span class="op">$</span>rowIndex),CLASS1]))</span>
<span id="cb49-11"><a href="comp-models.html#cb49-11" aria-hidden="true"></a>   ProbClass1.mtx})</span>
<span id="cb49-12"><a href="comp-models.html#cb49-12" aria-hidden="true"></a></span>
<span id="cb49-13"><a href="comp-models.html#cb49-13" aria-hidden="true"></a> </span>
<span id="cb49-14"><a href="comp-models.html#cb49-14" aria-hidden="true"></a> <span class="co">#################################</span></span>
<span id="cb49-15"><a href="comp-models.html#cb49-15" aria-hidden="true"></a> <span class="co"># Use average osProb</span></span>
<span id="cb49-16"><a href="comp-models.html#cb49-16" aria-hidden="true"></a> <span class="co">#################################</span></span>
<span id="cb49-17"><a href="comp-models.html#cb49-17" aria-hidden="true"></a> Set.Train.mean_osProbClass1.mtx &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;cbind&#39;</span>, <span class="kw">lapply</span>(Set.ModelFit.osProbClass1.mtx.lst,</span>
<span id="cb49-18"><a href="comp-models.html#cb49-18" aria-hidden="true"></a>  <span class="cf">function</span>(osProbClass1.mtx) <span class="kw">apply</span>(osProbClass1.mtx,<span class="dv">1</span>,mean)))</span>
<span id="cb49-19"><a href="comp-models.html#cb49-19" aria-hidden="true"></a> <span class="kw">rownames</span>(Set.Train.mean_osProbClass1.mtx) &lt;-<span class="st"> </span><span class="kw">names</span>(Train.Label.vec)</span>
<span id="cb49-20"><a href="comp-models.html#cb49-20" aria-hidden="true"></a></span>
<span id="cb49-21"><a href="comp-models.html#cb49-21" aria-hidden="true"></a> <span class="co"># ROC</span></span>
<span id="cb49-22"><a href="comp-models.html#cb49-22" aria-hidden="true"></a>  Set.Train.mean_osProbClass1.roc.mtx.lst &lt;-</span>
<span id="cb49-23"><a href="comp-models.html#cb49-23" aria-hidden="true"></a><span class="st">  </span><span class="kw">lapply</span>(<span class="kw">colnames</span>(Set.Train.mean_osProbClass1.mtx), <span class="cf">function</span>(MM)</span>
<span id="cb49-24"><a href="comp-models.html#cb49-24" aria-hidden="true"></a>   <span class="kw">do.call</span>(<span class="st">&#39;rbind&#39;</span>, <span class="kw">lapply</span>(<span class="kw">rev</span>(<span class="kw">sort</span>(<span class="kw">unique</span>(Set.Train.mean_osProbClass1.mtx))),</span>
<span id="cb49-25"><a href="comp-models.html#cb49-25" aria-hidden="true"></a>    <span class="cf">function</span>(TS) {</span>
<span id="cb49-26"><a href="comp-models.html#cb49-26" aria-hidden="true"></a>     TP &lt;-<span class="st"> </span><span class="kw">sum</span>(Set.Train.mean_osProbClass1.mtx[,MM][Train.Label.vec<span class="op">==</span>CLASS1] <span class="op">&gt;</span><span class="st"> </span>TS, <span class="dt">na.rm=</span>T)</span>
<span id="cb49-27"><a href="comp-models.html#cb49-27" aria-hidden="true"></a>     FP &lt;-<span class="st"> </span><span class="kw">sum</span>(Set.Train.mean_osProbClass1.mtx[,MM][Train.Label.vec<span class="op">==</span>CLASS2] <span class="op">&gt;</span><span class="st"> </span>TS, <span class="dt">na.rm=</span>T)</span>
<span id="cb49-28"><a href="comp-models.html#cb49-28" aria-hidden="true"></a>        <span class="kw">c</span>(<span class="dt">TS=</span>TS, <span class="dt">TP=</span>TP, <span class="dt">FP=</span>FP)}))</span>
<span id="cb49-29"><a href="comp-models.html#cb49-29" aria-hidden="true"></a>   )</span>
<span id="cb49-30"><a href="comp-models.html#cb49-30" aria-hidden="true"></a> <span class="kw">names</span>(Set.Train.mean_osProbClass1.roc.mtx.lst) &lt;-<span class="st"> </span><span class="kw">colnames</span>(Set.Train.mean_osProbClass1.mtx)</span>
<span id="cb49-31"><a href="comp-models.html#cb49-31" aria-hidden="true"></a></span>
<span id="cb49-32"><a href="comp-models.html#cb49-32" aria-hidden="true"></a> <span class="co"># Get auc</span></span>
<span id="cb49-33"><a href="comp-models.html#cb49-33" aria-hidden="true"></a> Set.Train.mean_osProbClass1.auc.vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(Set.Train.mean_osProbClass1.mtx), <span class="cf">function</span>(CC)</span>
<span id="cb49-34"><a href="comp-models.html#cb49-34" aria-hidden="true"></a>   <span class="kw">auc</span>(Train.Label.vec, Set.Train.mean_osProbClass1.mtx[,CC]))</span>
<span id="cb49-35"><a href="comp-models.html#cb49-35" aria-hidden="true"></a> <span class="kw">names</span>(Set.Train.mean_osProbClass1.auc.vec) &lt;-<span class="st"> </span><span class="kw">colnames</span>(Set.Train.mean_osProbClass1.mtx)</span>
<span id="cb49-36"><a href="comp-models.html#cb49-36" aria-hidden="true"></a></span>
<span id="cb49-37"><a href="comp-models.html#cb49-37" aria-hidden="true"></a></span>
<span id="cb49-38"><a href="comp-models.html#cb49-38" aria-hidden="true"></a> <span class="kw">plot</span>(<span class="dt">x=</span><span class="kw">range</span>(<span class="kw">do.call</span>(<span class="st">&#39;c&#39;</span>, <span class="kw">lapply</span>(Set.Train.mean_osProbClass1.roc.mtx.lst,</span>
<span id="cb49-39"><a href="comp-models.html#cb49-39" aria-hidden="true"></a>                <span class="cf">function</span>(LL) LL[,<span class="st">&#39;FP&#39;</span>])))<span class="op">/</span><span class="kw">sum</span>(Train.Label.vec<span class="op">==</span>CLASS2),</span>
<span id="cb49-40"><a href="comp-models.html#cb49-40" aria-hidden="true"></a>      <span class="dt">y=</span><span class="kw">range</span>(<span class="kw">do.call</span>(<span class="st">&#39;c&#39;</span>, <span class="kw">lapply</span>(Set.Train.mean_osProbClass1.roc.mtx.lst,</span>
<span id="cb49-41"><a href="comp-models.html#cb49-41" aria-hidden="true"></a>                <span class="cf">function</span>(LL) LL[,<span class="st">&#39;TP&#39;</span>])))<span class="op">/</span><span class="kw">sum</span>(Train.Label.vec<span class="op">==</span>CLASS1),</span>
<span id="cb49-42"><a href="comp-models.html#cb49-42" aria-hidden="true"></a>      <span class="dt">xlab=</span><span class="st">&#39;FP&#39;</span>, <span class="dt">ylab=</span><span class="st">&#39;TP&#39;</span>, <span class="dt">type=</span><span class="st">&#39;n&#39;</span>)</span>
<span id="cb49-43"><a href="comp-models.html#cb49-43" aria-hidden="true"></a></span>
<span id="cb49-44"><a href="comp-models.html#cb49-44" aria-hidden="true"></a> <span class="cf">for</span>(II <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(Set.Train.mean_osProbClass1.roc.mtx.lst))</span>
<span id="cb49-45"><a href="comp-models.html#cb49-45" aria-hidden="true"></a> <span class="kw">lines</span>(<span class="dt">x=</span>Set.Train.mean_osProbClass1.roc.mtx.lst[[II]][,<span class="st">&#39;FP&#39;</span>]<span class="op">/</span><span class="kw">sum</span>(Train.Label.vec<span class="op">==</span>CLASS2),</span>
<span id="cb49-46"><a href="comp-models.html#cb49-46" aria-hidden="true"></a>       <span class="dt">y=</span>Set.Train.mean_osProbClass1.roc.mtx.lst[[II]][,<span class="st">&#39;TP&#39;</span>]<span class="op">/</span><span class="kw">sum</span>(Train.Label.vec<span class="op">==</span>CLASS1),</span>
<span id="cb49-47"><a href="comp-models.html#cb49-47" aria-hidden="true"></a>       <span class="dt">col=</span>Model.col[<span class="kw">names</span>(Set.Train.roc.mtx.lst)[II]])</span>
<span id="cb49-48"><a href="comp-models.html#cb49-48" aria-hidden="true"></a> <span class="kw">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="dt">col=</span><span class="st">&#39;grey&#39;</span>)</span>
<span id="cb49-49"><a href="comp-models.html#cb49-49" aria-hidden="true"></a> <span class="kw">legend</span>(<span class="st">&#39;bottomright&#39;</span>,</span>
<span id="cb49-50"><a href="comp-models.html#cb49-50" aria-hidden="true"></a>        <span class="dt">legend=</span><span class="kw">paste</span>(<span class="kw">names</span>(Set.Train.mean_osProbClass1.auc.vec), <span class="st">&#39;:&#39;</span>,</span>
<span id="cb49-51"><a href="comp-models.html#cb49-51" aria-hidden="true"></a>          <span class="kw">round</span>(Set.Train.mean_osProbClass1.auc.vec,<span class="dv">3</span>),<span class="dt">sep=</span><span class="st">&#39;&#39;</span>),</span>
<span id="cb49-52"><a href="comp-models.html#cb49-52" aria-hidden="true"></a>        <span class="dt">col=</span>Model.col[<span class="kw">names</span>(Set.Train.mean_osProbClass1.auc.vec)], <span class="dt">lty=</span><span class="dv">1</span>)</span>
<span id="cb49-53"><a href="comp-models.html#cb49-53" aria-hidden="true"></a> <span class="kw">title</span>(<span class="st">&#39;Model Performance on Train Set - OS mean Prob(MSS)&#39;</span>)</span></code></pre></div>
<!-- ######################################################################## -->
</div>
<div id="out-of-sample-set.train-individual-repeats" class="section level3" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Out-of-sample Set.Train: Individual Repeats</h3>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="comp-models.html#cb50-1" aria-hidden="true"></a> <span class="kw">suppressMessages</span>(<span class="kw">require</span>(pROC))</span>
<span id="cb50-2"><a href="comp-models.html#cb50-2" aria-hidden="true"></a></span>
<span id="cb50-3"><a href="comp-models.html#cb50-3" aria-hidden="true"></a> <span class="co">#################################</span></span>
<span id="cb50-4"><a href="comp-models.html#cb50-4" aria-hidden="true"></a> <span class="co"># Replot ROC keep individual rep osProbClass1</span></span>
<span id="cb50-5"><a href="comp-models.html#cb50-5" aria-hidden="true"></a> <span class="co">#################################</span></span>
<span id="cb50-6"><a href="comp-models.html#cb50-6" aria-hidden="true"></a> Set.Train.indiv_osProbClass1.mtx &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;cbind&#39;</span>, <span class="kw">lapply</span>(<span class="kw">names</span>(Set.ModelFit.osProbClass1.mtx.lst),</span>
<span id="cb50-7"><a href="comp-models.html#cb50-7" aria-hidden="true"></a>  <span class="cf">function</span>(MODEL) {</span>
<span id="cb50-8"><a href="comp-models.html#cb50-8" aria-hidden="true"></a>   osProbClass1.mtx &lt;-<span class="st"> </span>Set.ModelFit.osProbClass1.mtx.lst[[MODEL]]</span>
<span id="cb50-9"><a href="comp-models.html#cb50-9" aria-hidden="true"></a>   <span class="kw">colnames</span>(osProbClass1.mtx) &lt;-<span class="st"> </span><span class="kw">paste</span>(MODEL, <span class="kw">colnames</span>(osProbClass1.mtx),<span class="dt">sep=</span><span class="st">&#39;.&#39;</span>)</span>
<span id="cb50-10"><a href="comp-models.html#cb50-10" aria-hidden="true"></a>   osProbClass1.mtx}))</span>
<span id="cb50-11"><a href="comp-models.html#cb50-11" aria-hidden="true"></a> <span class="kw">rownames</span>(Set.Train.indiv_osProbClass1.mtx) &lt;-<span class="st"> </span><span class="kw">names</span>(Train.Label.vec)</span>
<span id="cb50-12"><a href="comp-models.html#cb50-12" aria-hidden="true"></a></span>
<span id="cb50-13"><a href="comp-models.html#cb50-13" aria-hidden="true"></a> <span class="co"># ROC</span></span>
<span id="cb50-14"><a href="comp-models.html#cb50-14" aria-hidden="true"></a> Set.Train.indiv_osProbClass1.roc.mtx.lst &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">colnames</span>(Set.Train.indiv_osProbClass1.mtx), <span class="cf">function</span>(MM)</span>
<span id="cb50-15"><a href="comp-models.html#cb50-15" aria-hidden="true"></a>    <span class="kw">do.call</span>(<span class="st">&#39;rbind&#39;</span>, <span class="kw">lapply</span>(<span class="kw">rev</span>(<span class="kw">sort</span>(<span class="kw">unique</span>(Set.Train.indiv_osProbClass1.mtx))),</span>
<span id="cb50-16"><a href="comp-models.html#cb50-16" aria-hidden="true"></a>     <span class="cf">function</span>(TS) {</span>
<span id="cb50-17"><a href="comp-models.html#cb50-17" aria-hidden="true"></a>        TP &lt;-<span class="st"> </span><span class="kw">sum</span>(Set.Train.indiv_osProbClass1.mtx[,MM][Train.Label.vec<span class="op">==</span>CLASS1] <span class="op">&gt;</span><span class="st"> </span>TS, <span class="dt">na.rm=</span>T)</span>
<span id="cb50-18"><a href="comp-models.html#cb50-18" aria-hidden="true"></a>        FP &lt;-<span class="st"> </span><span class="kw">sum</span>(Set.Train.indiv_osProbClass1.mtx[,MM][Train.Label.vec<span class="op">==</span>CLASS2] <span class="op">&gt;</span><span class="st"> </span>TS, <span class="dt">na.rm=</span>T)</span>
<span id="cb50-19"><a href="comp-models.html#cb50-19" aria-hidden="true"></a>        <span class="kw">c</span>(<span class="dt">TS=</span>TS, <span class="dt">TP=</span>TP, <span class="dt">FP=</span>FP)}))</span>
<span id="cb50-20"><a href="comp-models.html#cb50-20" aria-hidden="true"></a>   )</span>
<span id="cb50-21"><a href="comp-models.html#cb50-21" aria-hidden="true"></a> <span class="kw">names</span>(Set.Train.indiv_osProbClass1.roc.mtx.lst) &lt;-<span class="st"> </span><span class="kw">colnames</span>(Set.Train.indiv_osProbClass1.mtx)</span>
<span id="cb50-22"><a href="comp-models.html#cb50-22" aria-hidden="true"></a></span>
<span id="cb50-23"><a href="comp-models.html#cb50-23" aria-hidden="true"></a></span>
<span id="cb50-24"><a href="comp-models.html#cb50-24" aria-hidden="true"></a> <span class="co"># Get auc</span></span>
<span id="cb50-25"><a href="comp-models.html#cb50-25" aria-hidden="true"></a> Set.Train.indiv_osProbClass1.auc.vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(Set.Train.indiv_osProbClass1.mtx), <span class="cf">function</span>(CC)</span>
<span id="cb50-26"><a href="comp-models.html#cb50-26" aria-hidden="true"></a>   <span class="kw">auc</span>(Train.Label.vec, Set.Train.indiv_osProbClass1.mtx[,CC]))</span>
<span id="cb50-27"><a href="comp-models.html#cb50-27" aria-hidden="true"></a> <span class="kw">names</span>(Set.Train.indiv_osProbClass1.auc.vec) &lt;-<span class="st"> </span><span class="kw">colnames</span>(Set.Train.indiv_osProbClass1.mtx)</span>
<span id="cb50-28"><a href="comp-models.html#cb50-28" aria-hidden="true"></a></span>
<span id="cb50-29"><a href="comp-models.html#cb50-29" aria-hidden="true"></a> Set.Train.mean_indiv_osProbClass1.auc.vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">split</span>(Set.Train.indiv_osProbClass1.auc.vec,</span>
<span id="cb50-30"><a href="comp-models.html#cb50-30" aria-hidden="true"></a>   <span class="kw">sapply</span>(<span class="kw">strsplit</span>(<span class="kw">names</span>(Set.Train.indiv_osProbClass1.auc.vec), <span class="dt">split=</span><span class="st">&#39;</span><span class="ch">\\</span><span class="st">.&#39;</span>),<span class="st">&#39;[&#39;</span>,<span class="dv">1</span>)),</span>
<span id="cb50-31"><a href="comp-models.html#cb50-31" aria-hidden="true"></a>   mean)</span>
<span id="cb50-32"><a href="comp-models.html#cb50-32" aria-hidden="true"></a></span>
<span id="cb50-33"><a href="comp-models.html#cb50-33" aria-hidden="true"></a> <span class="kw">plot</span>(<span class="dt">x=</span><span class="kw">range</span>(<span class="kw">do.call</span>(<span class="st">&#39;c&#39;</span>, <span class="kw">lapply</span>(Set.Train.indiv_osProbClass1.roc.mtx.lst,</span>
<span id="cb50-34"><a href="comp-models.html#cb50-34" aria-hidden="true"></a>                <span class="cf">function</span>(LL) LL[,<span class="st">&#39;FP&#39;</span>])))<span class="op">/</span><span class="kw">sum</span>(Train.Label.vec<span class="op">==</span>CLASS2),</span>
<span id="cb50-35"><a href="comp-models.html#cb50-35" aria-hidden="true"></a>      <span class="dt">y=</span><span class="kw">range</span>(<span class="kw">do.call</span>(<span class="st">&#39;c&#39;</span>, <span class="kw">lapply</span>(Set.Train.indiv_osProbClass1.roc.mtx.lst,</span>
<span id="cb50-36"><a href="comp-models.html#cb50-36" aria-hidden="true"></a>                <span class="cf">function</span>(LL) LL[,<span class="st">&#39;TP&#39;</span>])))<span class="op">/</span><span class="kw">sum</span>(Train.Label.vec<span class="op">==</span>CLASS1),</span>
<span id="cb50-37"><a href="comp-models.html#cb50-37" aria-hidden="true"></a>      <span class="dt">xlab=</span><span class="st">&#39;FP&#39;</span>, <span class="dt">ylab=</span><span class="st">&#39;TP&#39;</span>, <span class="dt">type=</span><span class="st">&#39;n&#39;</span>)</span>
<span id="cb50-38"><a href="comp-models.html#cb50-38" aria-hidden="true"></a></span>
<span id="cb50-39"><a href="comp-models.html#cb50-39" aria-hidden="true"></a> <span class="cf">for</span>(II <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(Set.Train.indiv_osProbClass1.roc.mtx.lst))</span>
<span id="cb50-40"><a href="comp-models.html#cb50-40" aria-hidden="true"></a> <span class="kw">lines</span>(<span class="dt">x=</span>Set.Train.indiv_osProbClass1.roc.mtx.lst[[II]][,<span class="st">&#39;FP&#39;</span>]<span class="op">/</span><span class="kw">sum</span>(Train.Label.vec<span class="op">==</span>CLASS2),</span>
<span id="cb50-41"><a href="comp-models.html#cb50-41" aria-hidden="true"></a>       <span class="dt">y=</span>Set.Train.indiv_osProbClass1.roc.mtx.lst[[II]][,<span class="st">&#39;TP&#39;</span>]<span class="op">/</span><span class="kw">sum</span>(Train.Label.vec<span class="op">==</span>CLASS1),</span>
<span id="cb50-42"><a href="comp-models.html#cb50-42" aria-hidden="true"></a>       <span class="dt">col=</span>Model.col[<span class="kw">sapply</span>(<span class="kw">strsplit</span>(<span class="kw">names</span>(Set.Train.indiv_osProbClass1.roc.mtx.lst),<span class="st">&#39;</span><span class="ch">\\</span><span class="st">.&#39;</span>),<span class="st">&#39;[&#39;</span>,<span class="dv">1</span>)[II]])</span>
<span id="cb50-43"><a href="comp-models.html#cb50-43" aria-hidden="true"></a> <span class="kw">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="dt">col=</span><span class="st">&#39;grey&#39;</span>)</span>
<span id="cb50-44"><a href="comp-models.html#cb50-44" aria-hidden="true"></a> <span class="kw">legend</span>(<span class="st">&#39;bottomright&#39;</span>,</span>
<span id="cb50-45"><a href="comp-models.html#cb50-45" aria-hidden="true"></a>        <span class="dt">legend=</span><span class="kw">paste</span>(<span class="kw">names</span>(Set.Train.mean_indiv_osProbClass1.auc.vec), <span class="st">&#39;:&#39;</span>,</span>
<span id="cb50-46"><a href="comp-models.html#cb50-46" aria-hidden="true"></a>        <span class="kw">round</span>(Set.Train.mean_indiv_osProbClass1.auc.vec,<span class="dv">3</span>),<span class="dt">sep=</span><span class="st">&#39;&#39;</span>),</span>
<span id="cb50-47"><a href="comp-models.html#cb50-47" aria-hidden="true"></a>       <span class="dt">col=</span>Model.col[<span class="kw">names</span>(Set.Train.mean_indiv_osProbClass1.auc.vec)],<span class="dt">lty=</span><span class="dv">1</span>)</span>
<span id="cb50-48"><a href="comp-models.html#cb50-48" aria-hidden="true"></a> <span class="kw">title</span>(<span class="st">&#39;Model Performance on Set.Train Set - indiv OS Prob(MSS)&#39;</span>)</span>
<span id="cb50-49"><a href="comp-models.html#cb50-49" aria-hidden="true"></a></span>
<span id="cb50-50"><a href="comp-models.html#cb50-50" aria-hidden="true"></a></span>
<span id="cb50-51"><a href="comp-models.html#cb50-51" aria-hidden="true"></a> <span class="co"># Boxplot individual aucs</span></span>
<span id="cb50-52"><a href="comp-models.html#cb50-52" aria-hidden="true"></a> <span class="kw">boxplot</span>(<span class="kw">split</span>(Set.Train.indiv_osProbClass1.auc.vec,</span>
<span id="cb50-53"><a href="comp-models.html#cb50-53" aria-hidden="true"></a>   <span class="kw">sub</span>(<span class="st">&#39;Fit&#39;</span>,<span class="st">&#39;&#39;</span>, <span class="kw">sapply</span>(<span class="kw">strsplit</span>(<span class="kw">names</span>(Set.Train.indiv_osProbClass1.auc.vec), <span class="dt">split=</span><span class="st">&#39;</span><span class="ch">\\</span><span class="st">.&#39;</span>),<span class="st">&#39;[&#39;</span>,<span class="dv">1</span>))))</span>
<span id="cb50-54"><a href="comp-models.html#cb50-54" aria-hidden="true"></a> <span class="kw">title</span>(<span class="st">&#39;Distribution of AUC stats over CV reps&#39;</span>)</span>
<span id="cb50-55"><a href="comp-models.html#cb50-55" aria-hidden="true"></a></span>
<span id="cb50-56"><a href="comp-models.html#cb50-56" aria-hidden="true"></a>  Set.Train.indiv_osProbClass1.auc.mtx &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;rbind&#39;</span>,</span>
<span id="cb50-57"><a href="comp-models.html#cb50-57" aria-hidden="true"></a>  <span class="kw">lapply</span>(<span class="kw">split</span>(Set.Train.indiv_osProbClass1.auc.vec,</span>
<span id="cb50-58"><a href="comp-models.html#cb50-58" aria-hidden="true"></a>   <span class="kw">sapply</span>(<span class="kw">strsplit</span>(<span class="kw">names</span>(Set.Train.indiv_osProbClass1.auc.vec), <span class="dt">split=</span><span class="st">&#39;</span><span class="ch">\\</span><span class="st">.&#39;</span>),<span class="st">&#39;[&#39;</span>,<span class="dv">1</span>)),</span>
<span id="cb50-59"><a href="comp-models.html#cb50-59" aria-hidden="true"></a>   <span class="cf">function</span>(x) {Res=x; <span class="kw">names</span>(Res)&lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">strsplit</span>(<span class="kw">names</span>(Res),<span class="dt">split=</span><span class="st">&#39;</span><span class="ch">\\</span><span class="st">.&#39;</span>),<span class="st">&#39;[&#39;</span>,<span class="dv">2</span>);Res}))</span>
<span id="cb50-60"><a href="comp-models.html#cb50-60" aria-hidden="true"></a></span>
<span id="cb50-61"><a href="comp-models.html#cb50-61" aria-hidden="true"></a> <span class="co"># This is redundant</span></span>
<span id="cb50-62"><a href="comp-models.html#cb50-62" aria-hidden="true"></a> <span class="co">#kable(data.frame(Set.Train.indiv_osProbClass1.auc.mtx,</span></span>
<span id="cb50-63"><a href="comp-models.html#cb50-63" aria-hidden="true"></a>                  <span class="co">#mean_os=Set.Train.mean_osProbClass1.auc.vec),</span></span>
<span id="cb50-64"><a href="comp-models.html#cb50-64" aria-hidden="true"></a>                  <span class="co">##Test = Test.auc.vec),</span></span>
<span id="cb50-65"><a href="comp-models.html#cb50-65" aria-hidden="true"></a>    <span class="co">#digits=2, format=&#39;html&#39;,align=&#39;c&#39;)</span></span></code></pre></div>
<!-- ######################################################################## -->
</div>
<div id="compare-predicted-probabilities" class="section level3" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> Compare Predicted Probabilities</h3>
<p>With the repeated CV fitting set-up, we can examine the distribution of out-of-sample
predictions. This is useful to both characterize the mode of errors occuring
in a given model - are the errors due to bias or variability? - as well as
chracterizing samples - some samples may be mis-labelled or hard to
classify correctly.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="comp-models.html#cb51-1" aria-hidden="true"></a>  <span class="cf">if</span>(<span class="kw">sum</span>(<span class="kw">rownames</span>(Set.Train.indiv_osProbClass1.mtx) <span class="op">!=</span></span>
<span id="cb51-2"><a href="comp-models.html#cb51-2" aria-hidden="true"></a><span class="st">         </span><span class="kw">names</span>(Train.Label.vec)))</span>
<span id="cb51-3"><a href="comp-models.html#cb51-3" aria-hidden="true"></a>  <span class="kw">stop</span>(<span class="st">&quot;Sample ordering problem.&quot;</span>)</span>
<span id="cb51-4"><a href="comp-models.html#cb51-4" aria-hidden="true"></a></span>
<span id="cb51-5"><a href="comp-models.html#cb51-5" aria-hidden="true"></a>  <span class="co"># Reorder by Outcome</span></span>
<span id="cb51-6"><a href="comp-models.html#cb51-6" aria-hidden="true"></a>  row.o &lt;-<span class="st"> </span><span class="kw">order</span>(Train.Label.vec, <span class="kw">names</span>(Train.Label.vec))</span>
<span id="cb51-7"><a href="comp-models.html#cb51-7" aria-hidden="true"></a></span>
<span id="cb51-8"><a href="comp-models.html#cb51-8" aria-hidden="true"></a>  Col.Models.vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">strsplit</span>(<span class="kw">colnames</span>(Set.Train.indiv_osProbClass1.mtx), <span class="dt">split=</span><span class="st">&#39;</span><span class="ch">\\</span><span class="st">.&#39;</span>),<span class="st">&#39;[&#39;</span>,<span class="dv">1</span>)</span>
<span id="cb51-9"><a href="comp-models.html#cb51-9" aria-hidden="true"></a></span>
<span id="cb51-10"><a href="comp-models.html#cb51-10" aria-hidden="true"></a>  <span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="kw">length</span>(<span class="kw">unique</span>(Col.Models.vec)),<span class="dv">1</span>), <span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="dt">oma=</span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb51-11"><a href="comp-models.html#cb51-11" aria-hidden="true"></a></span>
<span id="cb51-12"><a href="comp-models.html#cb51-12" aria-hidden="true"></a>  <span class="cf">for</span>(MOD <span class="cf">in</span> <span class="kw">unique</span>(Col.Models.vec)) {</span>
<span id="cb51-13"><a href="comp-models.html#cb51-13" aria-hidden="true"></a>   Mod.cols &lt;-<span class="st"> </span><span class="kw">which</span>(Col.Models.vec<span class="op">==</span>MOD)</span>
<span id="cb51-14"><a href="comp-models.html#cb51-14" aria-hidden="true"></a></span>
<span id="cb51-15"><a href="comp-models.html#cb51-15" aria-hidden="true"></a>   box.out &lt;-</span>
<span id="cb51-16"><a href="comp-models.html#cb51-16" aria-hidden="true"></a><span class="st">   </span><span class="kw">boxplot</span>(<span class="kw">t</span>(Set.Train.indiv_osProbClass1.mtx[row.o,Mod.cols]),</span>
<span id="cb51-17"><a href="comp-models.html#cb51-17" aria-hidden="true"></a>           <span class="dt">col=</span><span class="kw">ifelse</span>(Train.Label.vec[row.o]<span class="op">==</span>CLASS1,<span class="dv">3</span>,<span class="dv">2</span>),</span>
<span id="cb51-18"><a href="comp-models.html#cb51-18" aria-hidden="true"></a>           <span class="dt">xaxt=</span><span class="st">&#39;n&#39;</span>, <span class="dt">outline=</span>F)</span>
<span id="cb51-19"><a href="comp-models.html#cb51-19" aria-hidden="true"></a>   <span class="kw">title</span>(MOD)</span>
<span id="cb51-20"><a href="comp-models.html#cb51-20" aria-hidden="true"></a>  }</span></code></pre></div>
<!-- ######################################################################## -->
</div>
</div>
<div id="look-at-variable-importance" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Look at Variable Importance</h2>
<p>The <code>caret</code> package provides methods to extract variable importance through
the <a href="">varImp</a> function. Here we will extract these assessments
for each model and compare with genes which have been identified as associated with
MSS status in other studies:</p>
<ul>
<li>BANERJEA <span class="citation">[<a href="#ref-Banerjea:2004aa" role="doc-biblioref">20</a>]</span></li>
<li>CROCE <span class="citation">[<a href="#ref-CROCE" role="doc-biblioref">21</a>]</span></li>
<li>JORISSEN <span class="citation">[<a href="#ref-Jorissen:2009aa" role="doc-biblioref">22</a>]</span></li>
<li>KOINUMA <span class="citation">[<a href="#ref-Koinuma:2005aa" role="doc-biblioref">23</a>]</span></li>
<li>KRUHOFFER <span class="citation">[<a href="#ref-Kruhoffer:2005aa" role="doc-biblioref">24</a>]</span></li>
<li>MORI <span class="citation">[<a href="#ref-Mori:2003aa" role="doc-biblioref">25</a>]</span></li>
</ul>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="comp-models.html#cb52-1" aria-hidden="true"></a>  MSSMSI.GeneSets.frm &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">file=</span><span class="kw">file.path</span>(EXT_DATA, <span class="st">&quot;ColonCancerGeneSets.tab&quot;</span>),</span>
<span id="cb52-2"><a href="comp-models.html#cb52-2" aria-hidden="true"></a>   <span class="dt">header=</span>T, <span class="dt">sep=</span><span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span>)</span>
<span id="cb52-3"><a href="comp-models.html#cb52-3" aria-hidden="true"></a></span>
<span id="cb52-4"><a href="comp-models.html#cb52-4" aria-hidden="true"></a>  GeneSets.lst &lt;-<span class="st"> </span><span class="kw">split</span>(MSSMSI.GeneSets.frm<span class="op">$</span>GeneSymbol, <span class="kw">toupper</span>(MSSMSI.GeneSets.frm<span class="op">$</span>ListName))</span>
<span id="cb52-5"><a href="comp-models.html#cb52-5" aria-hidden="true"></a>  GeneSets.lst &lt;-<span class="st"> </span>GeneSets.lst[<span class="kw">c</span>(<span class="st">&#39;BANERJEA&#39;</span>,<span class="st">&#39;CROCE&#39;</span>,<span class="st">&#39;JORISSEN&#39;</span>, <span class="st">&#39;KOINUMA&#39;</span>, <span class="st">&#39;KRUHOFFER&#39;</span>,<span class="st">&#39;MORI&#39;</span>)]</span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="comp-models.html#cb53-1" aria-hidden="true"></a> <span class="kw">suppressMessages</span>(<span class="kw">require</span>(caret))</span>
<span id="cb53-2"><a href="comp-models.html#cb53-2" aria-hidden="true"></a></span>
<span id="cb53-3"><a href="comp-models.html#cb53-3" aria-hidden="true"></a> <span class="co"># Load gene to probe set map</span></span>
<span id="cb53-4"><a href="comp-models.html#cb53-4" aria-hidden="true"></a> <span class="kw">load</span>(<span class="dt">file=</span><span class="kw">file.path</span>(WRKDIR, <span class="st">&#39;Data&#39;</span>, <span class="st">&#39;GeneNameMap.vec&#39;</span>))</span>
<span id="cb53-5"><a href="comp-models.html#cb53-5" aria-hidden="true"></a> </span>
<span id="cb53-6"><a href="comp-models.html#cb53-6" aria-hidden="true"></a> <span class="co"># Will also need the inverted map</span></span>
<span id="cb53-7"><a href="comp-models.html#cb53-7" aria-hidden="true"></a> GeneNameMap2.vec &lt;-<span class="st"> </span><span class="kw">names</span>(GeneNameMap.vec)</span>
<span id="cb53-8"><a href="comp-models.html#cb53-8" aria-hidden="true"></a> <span class="kw">names</span>(GeneNameMap2.vec) &lt;-<span class="st"> </span>GeneNameMap.vec</span>
<span id="cb53-9"><a href="comp-models.html#cb53-9" aria-hidden="true"></a></span>
<span id="cb53-10"><a href="comp-models.html#cb53-10" aria-hidden="true"></a>  Set.ModelFit.Top20.lst &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">setdiff</span>(<span class="kw">names</span>(Set.ModelFit.lst),</span>
<span id="cb53-11"><a href="comp-models.html#cb53-11" aria-hidden="true"></a>                                   <span class="kw">c</span>(<span class="st">&quot;knnFit&quot;</span>,<span class="st">&quot;sddaLDAFit&quot;</span>,<span class="st">&quot;sddaQDAFit&quot;</span>)),</span>
<span id="cb53-12"><a href="comp-models.html#cb53-12" aria-hidden="true"></a>  <span class="cf">function</span>(MOD) {</span>
<span id="cb53-13"><a href="comp-models.html#cb53-13" aria-hidden="true"></a>    <span class="co">#cat(MOD,&#39;\n&#39;)</span></span>
<span id="cb53-14"><a href="comp-models.html#cb53-14" aria-hidden="true"></a>    FIT &lt;-<span class="st"> </span>Set.ModelFit.lst[[MOD]]</span>
<span id="cb53-15"><a href="comp-models.html#cb53-15" aria-hidden="true"></a></span>
<span id="cb53-16"><a href="comp-models.html#cb53-16" aria-hidden="true"></a>    <span class="cf">if</span>(<span class="kw">is.element</span>(CLASS1, <span class="kw">colnames</span>(<span class="kw">varImp</span>(FIT)<span class="op">$</span>imp)))</span>
<span id="cb53-17"><a href="comp-models.html#cb53-17" aria-hidden="true"></a>    impVar.vec &lt;-<span class="st"> </span><span class="kw">varImp</span>(FIT)<span class="op">$</span>imp[,CLASS1] <span class="cf">else</span></span>
<span id="cb53-18"><a href="comp-models.html#cb53-18" aria-hidden="true"></a>    impVar.vec &lt;-<span class="st"> </span><span class="kw">varImp</span>(FIT)<span class="op">$</span>imp<span class="op">$</span>Overall</span>
<span id="cb53-19"><a href="comp-models.html#cb53-19" aria-hidden="true"></a></span>
<span id="cb53-20"><a href="comp-models.html#cb53-20" aria-hidden="true"></a>    top20.ndx &lt;-<span class="st"> </span><span class="kw">rev</span>(<span class="kw">order</span>(impVar.vec))[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>]</span>
<span id="cb53-21"><a href="comp-models.html#cb53-21" aria-hidden="true"></a>    varImp.vec &lt;-<span class="st"> </span>impVar.vec[top20.ndx]</span>
<span id="cb53-22"><a href="comp-models.html#cb53-22" aria-hidden="true"></a>    <span class="kw">names</span>(varImp.vec) &lt;-<span class="st"> </span><span class="kw">rownames</span>(<span class="kw">varImp</span>(FIT)<span class="op">$</span>imp)[top20.ndx]</span>
<span id="cb53-23"><a href="comp-models.html#cb53-23" aria-hidden="true"></a>    varImp.vec</span>
<span id="cb53-24"><a href="comp-models.html#cb53-24" aria-hidden="true"></a>    })</span>
<span id="cb53-25"><a href="comp-models.html#cb53-25" aria-hidden="true"></a>  <span class="kw">names</span>(Set.ModelFit.Top20.lst) &lt;-<span class="st"> </span><span class="kw">setdiff</span>(<span class="kw">names</span>(Set.ModelFit.lst),</span>
<span id="cb53-26"><a href="comp-models.html#cb53-26" aria-hidden="true"></a>                                   <span class="kw">c</span>(<span class="st">&quot;knnFit&quot;</span>,<span class="st">&quot;sddaLDAFit&quot;</span>,<span class="st">&quot;sddaQDAFit&quot;</span>))</span>
<span id="cb53-27"><a href="comp-models.html#cb53-27" aria-hidden="true"></a></span>
<span id="cb53-28"><a href="comp-models.html#cb53-28" aria-hidden="true"></a>  Top20.Name.vec &lt;-<span class="st"> </span><span class="kw">unique</span>(<span class="kw">do.call</span>(<span class="st">&#39;c&#39;</span>, <span class="kw">lapply</span>(Set.ModelFit.Top20.lst, <span class="cf">function</span>(VV) <span class="kw">names</span>(VV))))</span>
<span id="cb53-29"><a href="comp-models.html#cb53-29" aria-hidden="true"></a></span>
<span id="cb53-30"><a href="comp-models.html#cb53-30" aria-hidden="true"></a>  Top20.ProbeId.vec &lt;-<span class="st"> </span>GeneNameMap.vec[Top20.Name.vec]</span>
<span id="cb53-31"><a href="comp-models.html#cb53-31" aria-hidden="true"></a></span>
<span id="cb53-32"><a href="comp-models.html#cb53-32" aria-hidden="true"></a>  <span class="co"># Put together in a matrix</span></span>
<span id="cb53-33"><a href="comp-models.html#cb53-33" aria-hidden="true"></a>  Top20.varImp.mtx &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;cbind&#39;</span>, <span class="kw">lapply</span>(Set.ModelFit.Top20.lst,</span>
<span id="cb53-34"><a href="comp-models.html#cb53-34" aria-hidden="true"></a>   <span class="cf">function</span>(LL) LL[Top20.Name.vec]))</span>
<span id="cb53-35"><a href="comp-models.html#cb53-35" aria-hidden="true"></a>  <span class="kw">rownames</span>(Top20.varImp.mtx) &lt;-<span class="st"> </span>GeneNameMap.vec[Top20.Name.vec]</span>
<span id="cb53-36"><a href="comp-models.html#cb53-36" aria-hidden="true"></a>  Top20.varImp.mtx[<span class="kw">is.na</span>(Top20.varImp.mtx)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb53-37"><a href="comp-models.html#cb53-37" aria-hidden="true"></a></span>
<span id="cb53-38"><a href="comp-models.html#cb53-38" aria-hidden="true"></a>  <span class="co"># Reoder by ovrall importance</span></span>
<span id="cb53-39"><a href="comp-models.html#cb53-39" aria-hidden="true"></a>  varImp.med.vec &lt;-<span class="st"> </span><span class="kw">apply</span>(Top20.varImp.mtx,<span class="dv">1</span>,median)</span>
<span id="cb53-40"><a href="comp-models.html#cb53-40" aria-hidden="true"></a>  Top20.varImp.mtx &lt;-<span class="st"> </span>Top20.varImp.mtx[<span class="kw">rev</span>(<span class="kw">order</span>(varImp.med.vec)),]</span>
<span id="cb53-41"><a href="comp-models.html#cb53-41" aria-hidden="true"></a></span>
<span id="cb53-42"><a href="comp-models.html#cb53-42" aria-hidden="true"></a></span>
<span id="cb53-43"><a href="comp-models.html#cb53-43" aria-hidden="true"></a>  Top20.varImp.frm &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">PROBEID=</span><span class="kw">rownames</span>(Top20.varImp.mtx), </span>
<span id="cb53-44"><a href="comp-models.html#cb53-44" aria-hidden="true"></a>                                 <span class="dt">Gene=</span>GeneNameMap2.vec[<span class="kw">rownames</span>(Top20.varImp.mtx)],</span>
<span id="cb53-45"><a href="comp-models.html#cb53-45" aria-hidden="true"></a>                                 <span class="kw">round</span>(Top20.varImp.mtx))</span>
<span id="cb53-46"><a href="comp-models.html#cb53-46" aria-hidden="true"></a>  <span class="kw">names</span>(Top20.varImp.frm) &lt;-<span class="st"> </span><span class="kw">sub</span>(<span class="st">&#39;Fit&#39;</span>, <span class="st">&#39;&#39;</span>, <span class="kw">names</span>(Top20.varImp.frm))</span>
<span id="cb53-47"><a href="comp-models.html#cb53-47" aria-hidden="true"></a></span>
<span id="cb53-48"><a href="comp-models.html#cb53-48" aria-hidden="true"></a></span>
<span id="cb53-49"><a href="comp-models.html#cb53-49" aria-hidden="true"></a></span>
<span id="cb53-50"><a href="comp-models.html#cb53-50" aria-hidden="true"></a>  <span class="co"># Add geneset membership</span></span>
<span id="cb53-51"><a href="comp-models.html#cb53-51" aria-hidden="true"></a>  Top20Genes.vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">strsplit</span>(Top20.varImp.frm<span class="op">$</span>Gene, <span class="dt">split=</span><span class="st">&#39;</span><span class="ch">\\</span><span class="st">.&#39;</span>),<span class="st">&#39;[&#39;</span>,<span class="dv">1</span>)</span>
<span id="cb53-52"><a href="comp-models.html#cb53-52" aria-hidden="true"></a></span>
<span id="cb53-53"><a href="comp-models.html#cb53-53" aria-hidden="true"></a>  Top20GeneSetElements.frm &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">do.call</span>(<span class="st">&#39;cbind&#39;</span>, <span class="kw">lapply</span>(GeneSets.lst,</span>
<span id="cb53-54"><a href="comp-models.html#cb53-54" aria-hidden="true"></a>  <span class="cf">function</span>(GS) <span class="kw">ifelse</span>(<span class="kw">is.element</span>(Top20Genes.vec, GS),<span class="st">&#39;Y&#39;</span>,<span class="st">&#39;&#39;</span>))))</span>
<span id="cb53-55"><a href="comp-models.html#cb53-55" aria-hidden="true"></a>  <span class="kw">colnames</span>(Top20GeneSetElements.frm) &lt;-<span class="st"> </span><span class="kw">names</span>(GeneSets.lst)</span>
<span id="cb53-56"><a href="comp-models.html#cb53-56" aria-hidden="true"></a></span>
<span id="cb53-57"><a href="comp-models.html#cb53-57" aria-hidden="true"></a>  Top20.varImp.frm &lt;-<span class="st"> </span><span class="kw">data.frame</span>(Top20.varImp.frm, Top20GeneSetElements.frm)</span>
<span id="cb53-58"><a href="comp-models.html#cb53-58" aria-hidden="true"></a></span>
<span id="cb53-59"><a href="comp-models.html#cb53-59" aria-hidden="true"></a>  o.v &lt;-<span class="st"> </span><span class="kw">rev</span>(<span class="kw">order</span>(<span class="kw">apply</span>(Top20.varImp.frm[,<span class="kw">sub</span>(<span class="st">&#39;Fit&#39;</span>,<span class="st">&#39;&#39;</span>,<span class="kw">names</span>(Set.ModelFit.Top20.lst))],</span>
<span id="cb53-60"><a href="comp-models.html#cb53-60" aria-hidden="true"></a>           <span class="dv">1</span>, mean)))</span>
<span id="cb53-61"><a href="comp-models.html#cb53-61" aria-hidden="true"></a>  <span class="kw">print</span>(<span class="kw">kable</span>(Top20.varImp.frm[o.v,], <span class="dt">align=</span><span class="st">&#39;c&#39;</span>, <span class="dt">row.names=</span>F))</span></code></pre></div>
</div>
<div id="classification-discussion" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Classification: Discussion</h2>
<div id="nearest-shrunken-centroids-does-well" class="section level3" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> Nearest shrunken centroids does well</h3>
<p>The <a href="http://statweb.stanford.edu/~tibs/PAM/">nearest shrunken centriod</a>
method described in Tibshirani et. al. [Tibshirani:2002aa] does very well
both in terms of classification accuracy, computing time and simplicity
of predictor. This has been our experience with many classification
problems based on gene expression data.</p>
</div>
<div id="lack-of-agreement-with-literature-gene-sets" class="section level3" number="4.6.2">
<h3><span class="header-section-number">4.6.2</span> Lack of agreement with literature gene sets</h3>
<p>The variable importance assessment shows that the genes which
are deemed important in the clsssifiers the we fitted
have little overlap with the gene sets previously identified
as being associated with MSS status. Part of this lack of overlap
is certanly due to the gene selection filter which we applied here
for computing purposes. This not a problem if we just want to
build a classifier which predicts well. It is somewhat of a problem
if we want to use biology to validate our empirically determined models.
In that respect, the lack of agreement of gene lists across analyses
is always a problem to contend with.</p>
</div>
<div id="models-could-be-better-optimized" class="section level3" number="4.6.3">
<h3><span class="header-section-number">4.6.3</span> Models could be better optimized</h3>
<p>Note that we did not attempt to optimize the model tuning parameters in
any way and just used the default search grids for each model. While
this may be a good choice on average, better performance could be
obtained from some of the models by specifying a tuning parameter
space which is better suited to the problem at hand. This requires
a good understanding of each model and is beyond the scope of this
vignette.</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Banerjea:2004aa">
<p>20. Banerjea, A., Ahmed, S., Hands, R.E., Huang, F., Han, X., Shaw, P.M., Feakins, R., Bustin, S.A., and Dorudi, S. (2004). Colorectal cancers with microsatellite instability display mRNA expression signatures characteristic of increased immunogenicity. Molecular Cancer <em>3</em>, 21. Available at: <a href="http://dx.doi.org/10.1186/1476-4598-3-21">http://dx.doi.org/10.1186/1476-4598-3-21</a>.</p>
</div>
<div id="ref-CROCE">
<p>21. Lanza, G., Ferracin, M., Gafà, R., Veronese, A., Spizzo, R., Pichiorri, F., Liu, C.-g., Calin, G.A., Croce, C.M., and Negrini, M. (2007). MRNA/microRNA gene expression profile in microsatellite unstable colorectal cancer. Molecular Cancer <em>6</em>, 54–54. Available at: <a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2048978/">http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2048978/</a>.</p>
</div>
<div id="ref-Jorissen:2009aa">
<p>22. Jorissen, R.N., Gibbs, P., Christie, M., Prakash, S., Lipton, L., Desai, J., Kerr, D., Aaltonen, L.A., Arango, D., and Kruhøffer, M. <em>et al.</em> Metastasis-associated gene expression changes predict poor outcomes in patients with dukes’stage b and c colorectal cancer. Clinical cancer research : an official journal of the American Association for Cancer Research <em>15</em>, 7642–7651. Available at: <a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2920750/">http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2920750/</a>.</p>
</div>
<div id="ref-Koinuma:2005aa">
<p>23. Koinuma, K., Yamashita, Y., Liu, W., Hatanaka, H., Kurashina, K., Wada, T., Takada, S., Kaneda, R., Choi, Y.L., and Fujiwara, S.-I. <em>et al.</em> Epigenetic silencing of axin2 in colorectal carcinoma with microsatellite instability. Oncogene <em>25</em>, 139–146. Available at: <a href="http://dx.doi.org/10.1038/sj.onc.1209009">http://dx.doi.org/10.1038/sj.onc.1209009</a>.</p>
</div>
<div id="ref-Kruhoffer:2005aa">
<p>24. Kruhøffer, M., Jensen, J.L., Laiho, P., Dyrskjøt, L., Salovaara, R., Arango, D., Birkenkamp-Demtroder, K., Sørensen, F.B., Christensen, L.L., and Buhl, L. <em>et al.</em> Gene expression signatures for colorectal cancer microsatellite status and hnpcc. British Journal of Cancer <em>92</em>, 2240–2248. Available at: <a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2361815/">http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2361815/</a>.</p>
</div>
<div id="ref-Mori:2003aa">
<p>25. Mori, Y., Selaru, F.M., Sato, F., Yin, J., Simms, L.A., Xu, Y., Olaru, A., Deacu, E., Wang, S., and Taylor, J.M. <em>et al.</em> The impact of microsatellite instability on the molecular phenotype of colorectal tumors. Cancer Research <em>63</em>, 4577. Available at: <a href="http://cancerres.aacrjournals.org/content/63/15/4577.abstract">http://cancerres.aacrjournals.org/content/63/15/4577.abstract</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="train-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="clustering.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ExploreCRC.pdf", "ExploreCRC.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
