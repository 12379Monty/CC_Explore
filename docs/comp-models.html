<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 4 Compare Predictive Models | Classification and Clustering: Case Study with CRC Gene Expression Data</title>
  <meta name="description" content="Classification and clustering methodes are explored using colorectal data from GEO website" />
  <meta name="generator" content="bookdown 0.20.6 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 4 Compare Predictive Models | Classification and Clustering: Case Study with CRC Gene Expression Data" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Classification and clustering methodes are explored using colorectal data from GEO website" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 4 Compare Predictive Models | Classification and Clustering: Case Study with CRC Gene Expression Data" />
  
  <meta name="twitter:description" content="Classification and clustering methodes are explored using colorectal data from GEO website" />
  

<meta name="author" content="Francois Collin" />


<meta name="date" content="2020-01-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="train-models.html"/>
<link rel="next" href="clustering.html"/>
<script src="libs/header-attrs-2.4/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.15/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<script type="text/javascript">
// source:https://stackoverflow.com/questions/45360998/code-folding-in-bookdown
// toggle visibility of R source blocks in R Markdown output
function toggle_R() {
  var x = document.getElementsByClassName('r');
  if (x.length == 0) return;
  function toggle_vis(o) {
    var d = o.style.display;
    o.style.display = (d == 'block' || d == '') ? 'none':'block';
  }

  for (i = 0; i < x.length; i++) {
    var y = x[i];
    if (y.tagName.toLowerCase() === 'pre') toggle_vis(y);
  }

    var elem = document.getElementById("myButton1");
    if (elem.value === "Hide Global") elem.value = "Show Global";
    else elem.value = "Hide Global";
}

document.write('<input onclick="toggle_R();" type="button" value="Hide Global" id="myButton1" style="position: absolute; top: 10%; right: 2%; z-index: 200"></input>')

</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Genomic Scale Classification and Clustering</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preamble</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#outline"><i class="fa fa-check"></i><b>1.1</b> Outline</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#data-preprocessing"><i class="fa fa-check"></i><b>1.2</b> Data Preprocessing</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#affymetrix-probe-sets-vs-genes"><i class="fa fa-check"></i><b>1.3</b> Affymetrix Probe Sets vs Genes</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#building-a-classifier"><i class="fa fa-check"></i><b>1.4</b> Building a Classifier</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#classifier-assessment"><i class="fa fa-check"></i><b>1.5</b> Classifier Assessment</a></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#subclass-discovery"><i class="fa fa-check"></i><b>1.6</b> Subclass Discovery</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="load-data.html"><a href="load-data.html"><i class="fa fa-check"></i><b>2</b> Load Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="load-data.html"><a href="load-data.html#download-datasets"><i class="fa fa-check"></i><b>2.1</b> Download Datasets</a></li>
<li class="chapter" data-level="2.2" data-path="load-data.html"><a href="load-data.html#peek-into-datasets"><i class="fa fa-check"></i><b>2.2</b> Peek into Datasets</a></li>
<li class="chapter" data-level="2.3" data-path="load-data.html"><a href="load-data.html#dataset-cleaning"><i class="fa fa-check"></i><b>2.3</b> Dataset Cleaning</a></li>
<li class="chapter" data-level="2.4" data-path="load-data.html"><a href="load-data.html#data-pooling"><i class="fa fa-check"></i><b>2.4</b> Data Pooling</a></li>
<li class="chapter" data-level="2.5" data-path="load-data.html"><a href="load-data.html#batch-correction"><i class="fa fa-check"></i><b>2.5</b> Batch Correction</a></li>
<li class="chapter" data-level="2.6" data-path="load-data.html"><a href="load-data.html#separate-data-set-into-train-and-test-subsets"><i class="fa fa-check"></i><b>2.6</b> Separate Data Set into Train and Test Subsets</a></li>
<li class="chapter" data-level="2.7" data-path="load-data.html"><a href="load-data.html#save-gene-sets"><i class="fa fa-check"></i><b>2.7</b> Save Gene Sets</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="train-models.html"><a href="train-models.html"><i class="fa fa-check"></i><b>3</b> Train Predictive Models</a>
<ul>
<li class="chapter" data-level="3.1" data-path="train-models.html"><a href="train-models.html#glmnet---elastic-net-regularized-generalized-linear-models"><i class="fa fa-check"></i><b>3.1</b> glmnet - Elastic-Net Regularized Generalized Linear Models</a></li>
<li class="chapter" data-level="3.2" data-path="train-models.html"><a href="train-models.html#enet---elastic-net-regularized-generalized-linear-models"><i class="fa fa-check"></i><b>3.2</b> enet - Elastic-Net Regularized Generalized Linear Models</a></li>
<li class="chapter" data-level="3.3" data-path="train-models.html"><a href="train-models.html#knn---k-nearest-neighbors"><i class="fa fa-check"></i><b>3.3</b> knn - k nearest neighbors</a></li>
<li class="chapter" data-level="3.4" data-path="train-models.html"><a href="train-models.html#pam---nearest-shrunken-centroid"><i class="fa fa-check"></i><b>3.4</b> pam - nearest shrunken centroid</a></li>
<li class="chapter" data-level="3.5" data-path="train-models.html"><a href="train-models.html#svmradial---support-vector-machines-rbf-kernel"><i class="fa fa-check"></i><b>3.5</b> svmRadial - Support vector machines (RBF kernel)</a></li>
<li class="chapter" data-level="3.6" data-path="train-models.html"><a href="train-models.html#gbm---boosted-trees"><i class="fa fa-check"></i><b>3.6</b> gbm - Boosted trees</a></li>
<li class="chapter" data-level="3.7" data-path="train-models.html"><a href="train-models.html#xgblinear---extreme-gradient-boosting"><i class="fa fa-check"></i><b>3.7</b> xgbLinear - eXtreme Gradient Boosting</a></li>
<li class="chapter" data-level="3.8" data-path="train-models.html"><a href="train-models.html#rf---random-forests"><i class="fa fa-check"></i><b>3.8</b> rf - Random forests</a></li>
<li class="chapter" data-level="3.9" data-path="train-models.html"><a href="train-models.html#stepldafit---stepwise-linear-discriminant-analysis"><i class="fa fa-check"></i><b>3.9</b> stepLDAFit - Stepwise linear discriminant analysis</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="comp-models.html"><a href="comp-models.html"><i class="fa fa-check"></i><b>4</b> Compare Predictive Models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="comp-models.html"><a href="comp-models.html#load-models"><i class="fa fa-check"></i><b>4.1</b> Load Models</a></li>
<li class="chapter" data-level="4.2" data-path="comp-models.html"><a href="comp-models.html#compare-times"><i class="fa fa-check"></i><b>4.2</b> Compare Times</a></li>
<li class="chapter" data-level="4.3" data-path="comp-models.html"><a href="comp-models.html#compare-prediction-accuracy"><i class="fa fa-check"></i><b>4.3</b> Compare Prediction Accuracy</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="comp-models.html"><a href="comp-models.html#out-of-fold-train-data-accuracy"><i class="fa fa-check"></i><b>4.3.1</b> Out-of-Fold Train Data Accuracy</a></li>
<li class="chapter" data-level="4.3.2" data-path="comp-models.html"><a href="comp-models.html#test-data-accuracy"><i class="fa fa-check"></i><b>4.3.2</b> Test Data Accuracy</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="comp-models.html"><a href="comp-models.html#compare-models-in-terms-of-roc"><i class="fa fa-check"></i><b>4.4</b> Compare Models in Terms of ROC</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="comp-models.html"><a href="comp-models.html#training-data-roc"><i class="fa fa-check"></i><b>4.4.1</b> Training Data ROC</a></li>
<li class="chapter" data-level="4.4.2" data-path="comp-models.html"><a href="comp-models.html#out-of-fold-train-average-over-repeats"><i class="fa fa-check"></i><b>4.4.2</b> Out-of-fold Train: Average over Repeats</a></li>
<li class="chapter" data-level="4.4.3" data-path="comp-models.html"><a href="comp-models.html#compare-predicted-probabilities"><i class="fa fa-check"></i><b>4.4.3</b> Compare Predicted Probabilities</a></li>
<li class="chapter" data-level="4.4.4" data-path="comp-models.html"><a href="comp-models.html#compare-predicted-probabilities---test-set"><i class="fa fa-check"></i><b>4.4.4</b> Compare Predicted Probabilities - Test Set</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="comp-models.html"><a href="comp-models.html#look-at-variable-importance"><i class="fa fa-check"></i><b>4.5</b> Look at Variable Importance</a></li>
<li class="chapter" data-level="4.6" data-path="comp-models.html"><a href="comp-models.html#classification-discussion"><i class="fa fa-check"></i><b>4.6</b> Classification: Discussion</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="clustering.html"><a href="clustering.html"><i class="fa fa-check"></i><b>5</b> Cluster Analysis</a>
<ul>
<li class="chapter" data-level="5.1" data-path="clustering.html"><a href="clustering.html#bootstrap-aggregation-of-clusters"><i class="fa fa-check"></i><b>5.1</b> Bootstrap Aggregation of Clusters</a></li>
<li class="chapter" data-level="5.2" data-path="clustering.html"><a href="clustering.html#t-sne"><i class="fa fa-check"></i><b>5.2</b> t-SNE</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="clustering.html"><a href="clustering.html#t-sne-pam"><i class="fa fa-check"></i><b>5.2.1</b> t-SNE + PAM</a></li>
<li class="chapter" data-level="5.2.2" data-path="clustering.html"><a href="clustering.html#t-sne-bagclust2"><i class="fa fa-check"></i><b>5.2.2</b> t-SNE + BagClust2</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="clustering.html"><a href="clustering.html#cluster-analysis-discussion"><i class="fa fa-check"></i><b>5.3</b> Cluster Analysis: Discussion</a></li>
<li class="chapter" data-level="5.4" data-path="clustering.html"><a href="clustering.html#next-step-look-for-subgroups-in-the-mss-population---an-open-biological-question."><i class="fa fa-check"></i><b>5.4</b> Next Step: Look for subgroups in the MSS population - an open biological question.</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>6</b> Results Summary</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="LICENSE.md" style="font:em;" target="blank">Copyright (c) 2020 Francois Collin</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Classification and Clustering: Case Study with CRC Gene Expression Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="comp-models" class="section level1" number="4">
<h1><span class="header-section-number">Section 4</span> Compare Predictive Models</h1>
<p>Here we compare predictive models in terms of:</p>
<ul>
<li>Processing time</li>
<li>Prediction accuracy and ROC on train <code>out-of-fold</code></li>
<li>Prediction accuracy and ROC on test samples</li>
<li>Direct comparison of variable importance</li>
</ul>
<div id="load-models" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Load Models</h2>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="comp-models.html#cb108-1" aria-hidden="true"></a><span class="co">### BREAK CACHE</span></span>
<span id="cb108-2"><a href="comp-models.html#cb108-2" aria-hidden="true"></a></span>
<span id="cb108-3"><a href="comp-models.html#cb108-3" aria-hidden="true"></a> <span class="co"># Load Train and Test Data</span></span>
<span id="cb108-4"><a href="comp-models.html#cb108-4" aria-hidden="true"></a> <span class="kw">load</span>(<span class="dt">file=</span><span class="kw">file.path</span>(<span class="st">&#39;RData&#39;</span>, <span class="st">&#39;Train.Expr.mtx&#39;</span>))</span>
<span id="cb108-5"><a href="comp-models.html#cb108-5" aria-hidden="true"></a> <span class="kw">load</span>(<span class="dt">file=</span><span class="kw">file.path</span>(<span class="st">&#39;RData&#39;</span>, <span class="st">&#39;Test.Expr.mtx&#39;</span>))</span>
<span id="cb108-6"><a href="comp-models.html#cb108-6" aria-hidden="true"></a> <span class="kw">load</span>(<span class="dt">file=</span><span class="kw">file.path</span>(<span class="st">&#39;RData&#39;</span>, <span class="st">&#39;Train.Label.vec&#39;</span>))</span>
<span id="cb108-7"><a href="comp-models.html#cb108-7" aria-hidden="true"></a> <span class="kw">load</span>(<span class="dt">file=</span><span class="kw">file.path</span>(<span class="st">&#39;RData&#39;</span>, <span class="st">&#39;Test.Label.vec&#39;</span>))</span>
<span id="cb108-8"><a href="comp-models.html#cb108-8" aria-hidden="true"></a></span>
<span id="cb108-9"><a href="comp-models.html#cb108-9" aria-hidden="true"></a> CLASS1 &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">sort</span>(<span class="kw">unique</span>(Train.Label.vec))[<span class="dv">1</span>])</span>
<span id="cb108-10"><a href="comp-models.html#cb108-10" aria-hidden="true"></a> CLASS2 &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">sort</span>(<span class="kw">unique</span>(Train.Label.vec))[<span class="dv">2</span>])</span>
<span id="cb108-11"><a href="comp-models.html#cb108-11" aria-hidden="true"></a></span>
<span id="cb108-12"><a href="comp-models.html#cb108-12" aria-hidden="true"></a> <span class="co"># Load models (Only CV.5_10?)</span></span>
<span id="cb108-13"><a href="comp-models.html#cb108-13" aria-hidden="true"></a> ModelFit.vec &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="kw">file.path</span>(<span class="st">&#39;RData&#39;</span>), <span class="st">&#39;Fit$&#39;</span>)</span>
<span id="cb108-14"><a href="comp-models.html#cb108-14" aria-hidden="true"></a></span>
<span id="cb108-15"><a href="comp-models.html#cb108-15" aria-hidden="true"></a> FitSetCV.vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">strsplit</span>(ModelFit.vec, <span class="dt">split=</span><span class="st">&#39;</span><span class="ch">\\</span><span class="st">.&#39;</span>),</span>
<span id="cb108-16"><a href="comp-models.html#cb108-16" aria-hidden="true"></a>            <span class="cf">function</span>(x) <span class="kw">paste</span>(x[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dt">collapse=</span><span class="st">&#39;.&#39;</span>))</span>
<span id="cb108-17"><a href="comp-models.html#cb108-17" aria-hidden="true"></a></span>
<span id="cb108-18"><a href="comp-models.html#cb108-18" aria-hidden="true"></a> ModelFit.lst &lt;-<span class="st"> </span><span class="kw">split</span>(<span class="kw">sapply</span>(<span class="kw">strsplit</span>(ModelFit.vec, <span class="dt">split=</span><span class="st">&#39;</span><span class="ch">\\</span><span class="st">.&#39;</span>), <span class="cf">function</span>(x) <span class="kw">rev</span>(x)[<span class="dv">1</span>]),</span>
<span id="cb108-19"><a href="comp-models.html#cb108-19" aria-hidden="true"></a>                       FitSetCV.vec)</span>
<span id="cb108-20"><a href="comp-models.html#cb108-20" aria-hidden="true"></a></span>
<span id="cb108-21"><a href="comp-models.html#cb108-21" aria-hidden="true"></a> <span class="co"># Get Model.col for plotting (only have one FitSetCV values here.  could have many)</span></span>
<span id="cb108-22"><a href="comp-models.html#cb108-22" aria-hidden="true"></a> Model.col &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.factor</span>(ModelFit.lst[[<span class="dv">1</span>]]))</span>
<span id="cb108-23"><a href="comp-models.html#cb108-23" aria-hidden="true"></a> <span class="kw">names</span>(Model.col) &lt;-<span class="st"> </span>ModelFit.lst[[<span class="dv">1</span>]]</span>
<span id="cb108-24"><a href="comp-models.html#cb108-24" aria-hidden="true"></a></span>
<span id="cb108-25"><a href="comp-models.html#cb108-25" aria-hidden="true"></a> <span class="kw">cat</span>(<span class="st">&quot;Found&quot;</span>, <span class="kw">length</span>(ModelFit.vec), <span class="st">&#39;models:</span><span class="ch">\n</span><span class="st">&#39;</span>)</span></code></pre></div>
<pre><code>## Found 10 models:</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="comp-models.html#cb110-1" aria-hidden="true"></a> <span class="kw">print</span>(ModelFit.lst)</span></code></pre></div>
<pre><code>## $Top30pVarGenes.CV.5_10
## [1] &quot;enetFit&quot;      &quot;gbmFit&quot;       &quot;glmnetFit&quot;    &quot;knnFit&quot;       &quot;pamFit&quot;      
## [6] &quot;rfFit&quot;        &quot;stepLDAFit&quot;   &quot;svmRadialFit&quot; &quot;xgbLinearFit&quot;
## 
## $Top60VarGenes.CV.10_30
## [1] &quot;glmnetFit&quot;</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="comp-models.html#cb112-1" aria-hidden="true"></a> <span class="co"># Load Models for single set (we cd have more than one set in FitSetCV.vec)</span></span>
<span id="cb112-2"><a href="comp-models.html#cb112-2" aria-hidden="true"></a> SET &lt;-<span class="st"> </span><span class="kw">names</span>(ModelFit.lst)[<span class="dv">1</span>]</span>
<span id="cb112-3"><a href="comp-models.html#cb112-3" aria-hidden="true"></a> Set.ModelFit.lst &lt;-<span class="st"> </span><span class="kw">lapply</span>(ModelFit.lst[[SET]],</span>
<span id="cb112-4"><a href="comp-models.html#cb112-4" aria-hidden="true"></a>  <span class="cf">function</span>(MF) {</span>
<span id="cb112-5"><a href="comp-models.html#cb112-5" aria-hidden="true"></a>   <span class="kw">loadObj</span>(<span class="kw">paste</span>(SET, MF, <span class="dt">sep=</span><span class="st">&#39;.&#39;</span>), <span class="st">&#39;ModelFit&#39;</span>)</span>
<span id="cb112-6"><a href="comp-models.html#cb112-6" aria-hidden="true"></a>   ModelFit})</span>
<span id="cb112-7"><a href="comp-models.html#cb112-7" aria-hidden="true"></a> <span class="kw">names</span>(Set.ModelFit.lst) &lt;-<span class="st"> </span>ModelFit.lst[[SET]]</span></code></pre></div>
<!-- ######################################################################## -->
</div>
<div id="compare-times" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Compare Times</h2>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="comp-models.html#cb113-1" aria-hidden="true"></a><span class="co">### BREAK CACHE</span></span>
<span id="cb113-2"><a href="comp-models.html#cb113-2" aria-hidden="true"></a></span>
<span id="cb113-3"><a href="comp-models.html#cb113-3" aria-hidden="true"></a>  Set.ModelTimes.frm &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;rbind&#39;</span>, <span class="kw">lapply</span>(Set.ModelFit.lst,</span>
<span id="cb113-4"><a href="comp-models.html#cb113-4" aria-hidden="true"></a>  <span class="cf">function</span>(LL) <span class="kw">c</span>(LL<span class="op">$</span>times<span class="op">$</span>everything)))<span class="co">###, final=LL$times$final)))</span></span>
<span id="cb113-5"><a href="comp-models.html#cb113-5" aria-hidden="true"></a></span>
<span id="cb113-6"><a href="comp-models.html#cb113-6" aria-hidden="true"></a>  knitr<span class="op">::</span><span class="kw">kable</span>(Set.ModelTimes.frm, <span class="dt">digits=</span><span class="dv">2</span>,</span>
<span id="cb113-7"><a href="comp-models.html#cb113-7" aria-hidden="true"></a>   <span class="dt">caption=</span><span class="st">&quot;Compute times&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb113-8"><a href="comp-models.html#cb113-8" aria-hidden="true"></a><span class="st">   </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:comp-models-compTimes">Table 4.1: </span>Compute times
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
user.self
</th>
<th style="text-align:right;">
sys.self
</th>
<th style="text-align:right;">
elapsed
</th>
<th style="text-align:right;">
user.child
</th>
<th style="text-align:right;">
sys.child
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
enetFit
</td>
<td style="text-align:right;">
4.47
</td>
<td style="text-align:right;">
0.32
</td>
<td style="text-align:right;">
39.88
</td>
<td style="text-align:right;">
345.94
</td>
<td style="text-align:right;">
25.15
</td>
</tr>
<tr>
<td style="text-align:left;">
gbmFit
</td>
<td style="text-align:right;">
13.32
</td>
<td style="text-align:right;">
0.49
</td>
<td style="text-align:right;">
642.98
</td>
<td style="text-align:right;">
5629.85
</td>
<td style="text-align:right;">
64.28
</td>
</tr>
<tr>
<td style="text-align:left;">
glmnetFit
</td>
<td style="text-align:right;">
7.30
</td>
<td style="text-align:right;">
0.42
</td>
<td style="text-align:right;">
92.40
</td>
<td style="text-align:right;">
905.31
</td>
<td style="text-align:right;">
39.55
</td>
</tr>
<tr>
<td style="text-align:left;">
knnFit
</td>
<td style="text-align:right;">
2.81
</td>
<td style="text-align:right;">
1.71
</td>
<td style="text-align:right;">
5079.35
</td>
<td style="text-align:right;">
30945.02
</td>
<td style="text-align:right;">
943.51
</td>
</tr>
<tr>
<td style="text-align:left;">
pamFit
</td>
<td style="text-align:right;">
5.00
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
28.83
</td>
<td style="text-align:right;">
225.27
</td>
<td style="text-align:right;">
28.11
</td>
</tr>
<tr>
<td style="text-align:left;">
rfFit
</td>
<td style="text-align:right;">
96.90
</td>
<td style="text-align:right;">
0.77
</td>
<td style="text-align:right;">
18379.77
</td>
<td style="text-align:right;">
50295.81
</td>
<td style="text-align:right;">
122.04
</td>
</tr>
<tr>
<td style="text-align:left;">
stepLDAFit
</td>
<td style="text-align:right;">
522.52
</td>
<td style="text-align:right;">
3.37
</td>
<td style="text-align:right;">
24023.71
</td>
<td style="text-align:right;">
60883.12
</td>
<td style="text-align:right;">
232.92
</td>
</tr>
<tr>
<td style="text-align:left;">
svmRadialFit
</td>
<td style="text-align:right;">
19.22
</td>
<td style="text-align:right;">
1.63
</td>
<td style="text-align:right;">
501.06
</td>
<td style="text-align:right;">
5285.34
</td>
<td style="text-align:right;">
162.72
</td>
</tr>
<tr>
<td style="text-align:left;">
xgbLinearFit
</td>
<td style="text-align:right;">
17.67
</td>
<td style="text-align:right;">
0.53
</td>
<td style="text-align:right;">
28470.81
</td>
<td style="text-align:right;">
49661.41
</td>
<td style="text-align:right;">
238.33
</td>
</tr>
</tbody>
</table>
<!-- ######################################################################## -->
</div>
<div id="compare-prediction-accuracy" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Compare Prediction Accuracy</h2>
<!-- SKIP  - this is misleading and hard to explain 
### Train Data Accuracy

Train data accuracy is always perfect for models that
have a large paremeter space such a random forest models.
This assessment is only included here for reference purposes -
we cannot judge the relative performance of models having
vastly different parameter spaces based on training data results.
-->
<!-- ######################################################################## -->
<div id="out-of-fold-train-data-accuracy" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Out-of-Fold Train Data Accuracy</h3>
<p>Out-of-fold predictions are predictions for the left-out samples
at each iteration of the cross-validated model fitting process.</p>
<ul>
<li>The following tabulation uses model predictions
extracted by the <code>predict</code> method applied to fitted objects.
For models that produce a probability, a threshold of 0.5
will be used to classify observations. This can give a
misleading sense of relative performance.<br />
Figures <a href="comp-models.html#fig:comp-models-CompROCOOFTrain">4.2</a> and
<a href="comp-models.html#fig:comp-models-CompOOFSet-TrainProbClass1">4.3</a> must be
examined together to get a good sense of relative performance.</li>
</ul>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="comp-models.html#cb114-1" aria-hidden="true"></a><span class="co">### BREAK CACHE</span></span>
<span id="cb114-2"><a href="comp-models.html#cb114-2" aria-hidden="true"></a></span>
<span id="cb114-3"><a href="comp-models.html#cb114-3" aria-hidden="true"></a>  Set.ModelFit.osPred.mtx.lst &lt;-<span class="st"> </span><span class="kw">lapply</span>(Set.ModelFit.lst,</span>
<span id="cb114-4"><a href="comp-models.html#cb114-4" aria-hidden="true"></a> <span class="cf">function</span>(MF) {</span>
<span id="cb114-5"><a href="comp-models.html#cb114-5" aria-hidden="true"></a>   MF.pred.mtx &lt;-<span class="st"> </span>MF<span class="op">$</span>pred</span>
<span id="cb114-6"><a href="comp-models.html#cb114-6" aria-hidden="true"></a>   Rep.vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">strsplit</span>(MF<span class="op">$</span>pred<span class="op">$</span>Resample, <span class="dt">split=</span><span class="st">&#39;</span><span class="ch">\\</span><span class="st">.&#39;</span>),<span class="st">&#39;[&#39;</span>, <span class="dv">2</span>)</span>
<span id="cb114-7"><a href="comp-models.html#cb114-7" aria-hidden="true"></a>   rowIndex.vec &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">unique</span>(MF<span class="op">$</span>pred<span class="op">$</span>rowIndex))</span>
<span id="cb114-8"><a href="comp-models.html#cb114-8" aria-hidden="true"></a>   Pred.mtx &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;cbind&#39;</span>, <span class="kw">lapply</span>(<span class="kw">split</span>(MF<span class="op">$</span>pred, Rep.vec),</span>
<span id="cb114-9"><a href="comp-models.html#cb114-9" aria-hidden="true"></a>   <span class="cf">function</span>(RepMFpred.frm)</span>
<span id="cb114-10"><a href="comp-models.html#cb114-10" aria-hidden="true"></a>      <span class="kw">as.character</span>(RepMFpred.frm[<span class="kw">match</span>(rowIndex.vec, RepMFpred.frm<span class="op">$</span>rowIndex),<span class="st">&#39;pred&#39;</span>])))</span>
<span id="cb114-11"><a href="comp-models.html#cb114-11" aria-hidden="true"></a>   Pred.mtx})</span>
<span id="cb114-12"><a href="comp-models.html#cb114-12" aria-hidden="true"></a></span>
<span id="cb114-13"><a href="comp-models.html#cb114-13" aria-hidden="true"></a> <span class="co"># Use mode over reps as prediction</span></span>
<span id="cb114-14"><a href="comp-models.html#cb114-14" aria-hidden="true"></a> <span class="co">############################################</span></span>
<span id="cb114-15"><a href="comp-models.html#cb114-15" aria-hidden="true"></a> Set.ModelFit.osPred.vec.lst &lt;-<span class="st"> </span><span class="kw">lapply</span>(Set.ModelFit.osPred.mtx.lst,</span>
<span id="cb114-16"><a href="comp-models.html#cb114-16" aria-hidden="true"></a> <span class="cf">function</span>(PRED.mtx) <span class="kw">apply</span>(PRED.mtx,<span class="dv">1</span>,<span class="cf">function</span>(Pred.vec)</span>
<span id="cb114-17"><a href="comp-models.html#cb114-17" aria-hidden="true"></a> <span class="kw">names</span>(<span class="kw">table</span>(Pred.vec))[<span class="kw">which.max</span>(<span class="kw">table</span>(Pred.vec))]))</span>
<span id="cb114-18"><a href="comp-models.html#cb114-18" aria-hidden="true"></a></span>
<span id="cb114-19"><a href="comp-models.html#cb114-19" aria-hidden="true"></a> Set.Train.osPredMode.TruthTable.frm &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;rbind&#39;</span>, <span class="kw">lapply</span>(Set.ModelFit.osPred.vec.lst,</span>
<span id="cb114-20"><a href="comp-models.html#cb114-20" aria-hidden="true"></a> <span class="cf">function</span>(PRED) {</span>
<span id="cb114-21"><a href="comp-models.html#cb114-21" aria-hidden="true"></a>   truth.vec &lt;-<span class="st"> </span><span class="kw">as.vector</span>(<span class="kw">table</span>(PRED, Train.Label.vec))<span class="co">#/length(Train.Label.vec)</span></span>
<span id="cb114-22"><a href="comp-models.html#cb114-22" aria-hidden="true"></a>   <span class="co"># ASSUMING MSI is FIRST LABEL of CLASS</span></span>
<span id="cb114-23"><a href="comp-models.html#cb114-23" aria-hidden="true"></a>   <span class="kw">names</span>(truth.vec) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;TN&#39;</span>, <span class="st">&#39;FP&#39;</span>, <span class="st">&#39;FN&#39;</span>, <span class="st">&#39;TP&#39;</span>)</span>
<span id="cb114-24"><a href="comp-models.html#cb114-24" aria-hidden="true"></a>   truth.vec}))</span>
<span id="cb114-25"><a href="comp-models.html#cb114-25" aria-hidden="true"></a></span>
<span id="cb114-26"><a href="comp-models.html#cb114-26" aria-hidden="true"></a> knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">data.frame</span>(<span class="kw">cbind</span>(Set.Train.osPredMode.TruthTable.frm,</span>
<span id="cb114-27"><a href="comp-models.html#cb114-27" aria-hidden="true"></a>                  Set.Train.osPredMode.TruthTable.frm<span class="op">/</span><span class="kw">length</span>(Train.Label.vec))),</span>
<span id="cb114-28"><a href="comp-models.html#cb114-28" aria-hidden="true"></a>   <span class="dt">digits=</span><span class="dv">2</span>, <span class="dt">align=</span><span class="st">&#39;c&#39;</span>, <span class="dt">caption=</span><span class="st">&#39;Model Out-of-Fold Accuracy - Mode&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb114-29"><a href="comp-models.html#cb114-29" aria-hidden="true"></a><span class="st">   </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:comp-models-OOFTrainAccuracy">Table 4.2: </span>Model Out-of-Fold Accuracy - Mode
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
TN
</th>
<th style="text-align:center;">
FP
</th>
<th style="text-align:center;">
FN
</th>
<th style="text-align:center;">
TP
</th>
<th style="text-align:center;">
TN.1
</th>
<th style="text-align:center;">
FP.1
</th>
<th style="text-align:center;">
FN.1
</th>
<th style="text-align:center;">
TP.1
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
enetFit
</td>
<td style="text-align:center;">
81
</td>
<td style="text-align:center;">
29
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
221
</td>
<td style="text-align:center;">
0.24
</td>
<td style="text-align:center;">
0.09
</td>
<td style="text-align:center;">
0.01
</td>
<td style="text-align:center;">
0.66
</td>
</tr>
<tr>
<td style="text-align:left;">
gbmFit
</td>
<td style="text-align:center;">
93
</td>
<td style="text-align:center;">
17
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
220
</td>
<td style="text-align:center;">
0.28
</td>
<td style="text-align:center;">
0.05
</td>
<td style="text-align:center;">
0.01
</td>
<td style="text-align:center;">
0.66
</td>
</tr>
<tr>
<td style="text-align:left;">
glmnetFit
</td>
<td style="text-align:center;">
62
</td>
<td style="text-align:center;">
48
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
222
</td>
<td style="text-align:center;">
0.19
</td>
<td style="text-align:center;">
0.14
</td>
<td style="text-align:center;">
0.00
</td>
<td style="text-align:center;">
0.67
</td>
</tr>
<tr>
<td style="text-align:left;">
knnFit
</td>
<td style="text-align:center;">
13
</td>
<td style="text-align:center;">
97
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
222
</td>
<td style="text-align:center;">
0.04
</td>
<td style="text-align:center;">
0.29
</td>
<td style="text-align:center;">
0.00
</td>
<td style="text-align:center;">
0.67
</td>
</tr>
<tr>
<td style="text-align:left;">
pamFit
</td>
<td style="text-align:center;">
96
</td>
<td style="text-align:center;">
14
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
219
</td>
<td style="text-align:center;">
0.29
</td>
<td style="text-align:center;">
0.04
</td>
<td style="text-align:center;">
0.01
</td>
<td style="text-align:center;">
0.66
</td>
</tr>
<tr>
<td style="text-align:left;">
rfFit
</td>
<td style="text-align:center;">
90
</td>
<td style="text-align:center;">
20
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
220
</td>
<td style="text-align:center;">
0.27
</td>
<td style="text-align:center;">
0.06
</td>
<td style="text-align:center;">
0.01
</td>
<td style="text-align:center;">
0.66
</td>
</tr>
<tr>
<td style="text-align:left;">
stepLDAFit
</td>
<td style="text-align:center;">
87
</td>
<td style="text-align:center;">
23
</td>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
215
</td>
<td style="text-align:center;">
0.26
</td>
<td style="text-align:center;">
0.07
</td>
<td style="text-align:center;">
0.02
</td>
<td style="text-align:center;">
0.65
</td>
</tr>
<tr>
<td style="text-align:left;">
svmRadialFit
</td>
<td style="text-align:center;">
92
</td>
<td style="text-align:center;">
18
</td>
<td style="text-align:center;">
12
</td>
<td style="text-align:center;">
211
</td>
<td style="text-align:center;">
0.28
</td>
<td style="text-align:center;">
0.05
</td>
<td style="text-align:center;">
0.04
</td>
<td style="text-align:center;">
0.63
</td>
</tr>
<tr>
<td style="text-align:left;">
xgbLinearFit
</td>
<td style="text-align:center;">
95
</td>
<td style="text-align:center;">
15
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
218
</td>
<td style="text-align:center;">
0.29
</td>
<td style="text-align:center;">
0.05
</td>
<td style="text-align:center;">
0.02
</td>
<td style="text-align:center;">
0.65
</td>
</tr>
</tbody>
</table>
<!-- ######################################################################## -->
</div>
<div id="test-data-accuracy" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Test Data Accuracy</h3>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="comp-models.html#cb115-1" aria-hidden="true"></a><span class="co">### BREAK CACHE</span></span>
<span id="cb115-2"><a href="comp-models.html#cb115-2" aria-hidden="true"></a> <span class="kw">suppressMessages</span>(<span class="kw">require</span>(caret))</span>
<span id="cb115-3"><a href="comp-models.html#cb115-3" aria-hidden="true"></a></span>
<span id="cb115-4"><a href="comp-models.html#cb115-4" aria-hidden="true"></a> <span class="co"># Test - these are fitting errors</span></span>
<span id="cb115-5"><a href="comp-models.html#cb115-5" aria-hidden="true"></a> Set.Test.Pred.lst &lt;-<span class="st"> </span><span class="kw">lapply</span>(Set.ModelFit.lst,</span>
<span id="cb115-6"><a href="comp-models.html#cb115-6" aria-hidden="true"></a>          <span class="cf">function</span>(MF) <span class="kw">predict</span>(MF, <span class="dt">newdata=</span>Test.Expr.mtx))</span>
<span id="cb115-7"><a href="comp-models.html#cb115-7" aria-hidden="true"></a></span>
<span id="cb115-8"><a href="comp-models.html#cb115-8" aria-hidden="true"></a> Set.Test.TruthTable.frm &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;rbind&#39;</span>, <span class="kw">lapply</span>(Set.Test.Pred.lst,</span>
<span id="cb115-9"><a href="comp-models.html#cb115-9" aria-hidden="true"></a> <span class="cf">function</span>(PRED) {</span>
<span id="cb115-10"><a href="comp-models.html#cb115-10" aria-hidden="true"></a>   truth.vec &lt;-<span class="st"> </span><span class="kw">as.vector</span>(<span class="kw">table</span>(PRED, Test.Label.vec))<span class="co">#/length(Test.Label.vec)</span></span>
<span id="cb115-11"><a href="comp-models.html#cb115-11" aria-hidden="true"></a>   <span class="co"># ASSUMING MSI is FIRST LABEL of CLASS</span></span>
<span id="cb115-12"><a href="comp-models.html#cb115-12" aria-hidden="true"></a>   <span class="kw">names</span>(truth.vec) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;TN&#39;</span>, <span class="st">&#39;FP&#39;</span>, <span class="st">&#39;FN&#39;</span>, <span class="st">&#39;TP&#39;</span>)</span>
<span id="cb115-13"><a href="comp-models.html#cb115-13" aria-hidden="true"></a>   truth.vec}))</span>
<span id="cb115-14"><a href="comp-models.html#cb115-14" aria-hidden="true"></a></span>
<span id="cb115-15"><a href="comp-models.html#cb115-15" aria-hidden="true"></a> knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">data.frame</span>(<span class="kw">cbind</span>(Set.Test.TruthTable.frm,</span>
<span id="cb115-16"><a href="comp-models.html#cb115-16" aria-hidden="true"></a>                  Set.Test.TruthTable.frm<span class="op">/</span><span class="kw">length</span>(Test.Label.vec))),</span>
<span id="cb115-17"><a href="comp-models.html#cb115-17" aria-hidden="true"></a>   <span class="dt">digits=</span><span class="dv">2</span>, <span class="dt">align=</span><span class="st">&#39;c&#39;</span>, <span class="dt">caption=</span><span class="st">&#39;Model Test Set Accuracy&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb115-18"><a href="comp-models.html#cb115-18" aria-hidden="true"></a><span class="st">   </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:comp-models-testAccuracy">Table 4.3: </span>Model Test Set Accuracy
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
TN
</th>
<th style="text-align:center;">
FP
</th>
<th style="text-align:center;">
FN
</th>
<th style="text-align:center;">
TP
</th>
<th style="text-align:center;">
TN.1
</th>
<th style="text-align:center;">
FP.1
</th>
<th style="text-align:center;">
FN.1
</th>
<th style="text-align:center;">
TP.1
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
enetFit
</td>
<td style="text-align:center;">
29
</td>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
73
</td>
<td style="text-align:center;">
0.26
</td>
<td style="text-align:center;">
0.06
</td>
<td style="text-align:center;">
0.01
</td>
<td style="text-align:center;">
0.66
</td>
</tr>
<tr>
<td style="text-align:left;">
gbmFit
</td>
<td style="text-align:center;">
32
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
72
</td>
<td style="text-align:center;">
0.29
</td>
<td style="text-align:center;">
0.04
</td>
<td style="text-align:center;">
0.02
</td>
<td style="text-align:center;">
0.65
</td>
</tr>
<tr>
<td style="text-align:left;">
glmnetFit
</td>
<td style="text-align:center;">
21
</td>
<td style="text-align:center;">
15
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
73
</td>
<td style="text-align:center;">
0.19
</td>
<td style="text-align:center;">
0.14
</td>
<td style="text-align:center;">
0.01
</td>
<td style="text-align:center;">
0.66
</td>
</tr>
<tr>
<td style="text-align:left;">
knnFit
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
31
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
74
</td>
<td style="text-align:center;">
0.05
</td>
<td style="text-align:center;">
0.28
</td>
<td style="text-align:center;">
0.00
</td>
<td style="text-align:center;">
0.67
</td>
</tr>
<tr>
<td style="text-align:left;">
pamFit
</td>
<td style="text-align:center;">
34
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
70
</td>
<td style="text-align:center;">
0.31
</td>
<td style="text-align:center;">
0.02
</td>
<td style="text-align:center;">
0.04
</td>
<td style="text-align:center;">
0.64
</td>
</tr>
<tr>
<td style="text-align:left;">
rfFit
</td>
<td style="text-align:center;">
32
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
73
</td>
<td style="text-align:center;">
0.29
</td>
<td style="text-align:center;">
0.04
</td>
<td style="text-align:center;">
0.01
</td>
<td style="text-align:center;">
0.66
</td>
</tr>
<tr>
<td style="text-align:left;">
stepLDAFit
</td>
<td style="text-align:center;">
30
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
67
</td>
<td style="text-align:center;">
0.27
</td>
<td style="text-align:center;">
0.05
</td>
<td style="text-align:center;">
0.06
</td>
<td style="text-align:center;">
0.61
</td>
</tr>
<tr>
<td style="text-align:left;">
svmRadialFit
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.00
</td>
<td style="text-align:center;">
0.00
</td>
<td style="text-align:center;">
0.00
</td>
<td style="text-align:center;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
xgbLinearFit
</td>
<td style="text-align:center;">
31
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
70
</td>
<td style="text-align:center;">
0.28
</td>
<td style="text-align:center;">
0.05
</td>
<td style="text-align:center;">
0.04
</td>
<td style="text-align:center;">
0.64
</td>
</tr>
</tbody>
</table>
<!-- ######################################################################## -->
</div>
</div>
<div id="compare-models-in-terms-of-roc" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Compare Models in Terms of ROC</h2>
<div id="training-data-roc" class="section level3" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Training Data ROC</h3>
<p>Train data accuracy is always perfect for models that
have a large paremeter space such a random forest models.
This assessment is only included here for reference purposes -
we cannot judge the relative performance of models having
vastly different parameter spaces based on training data results.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="comp-models.html#cb116-1" aria-hidden="true"></a><span class="co">### BREAK CACHE</span></span>
<span id="cb116-2"><a href="comp-models.html#cb116-2" aria-hidden="true"></a> <span class="co"># CHANGE THIS LINE TO CLEAR CACHE</span></span>
<span id="cb116-3"><a href="comp-models.html#cb116-3" aria-hidden="true"></a> <span class="kw">suppressMessages</span>(<span class="kw">require</span>(pROC))</span>
<span id="cb116-4"><a href="comp-models.html#cb116-4" aria-hidden="true"></a></span>
<span id="cb116-5"><a href="comp-models.html#cb116-5" aria-hidden="true"></a> <span class="co">################################</span></span>
<span id="cb116-6"><a href="comp-models.html#cb116-6" aria-hidden="true"></a> <span class="co"># Train</span></span>
<span id="cb116-7"><a href="comp-models.html#cb116-7" aria-hidden="true"></a> <span class="co">################################</span></span>
<span id="cb116-8"><a href="comp-models.html#cb116-8" aria-hidden="true"></a> <span class="co"># Get predicted probabilities</span></span>
<span id="cb116-9"><a href="comp-models.html#cb116-9" aria-hidden="true"></a> Set.Train.Prob.lst &lt;-<span class="st"> </span><span class="kw">suppressMessages</span>(<span class="kw">predict</span>(Set.ModelFit.lst, <span class="dt">type=</span><span class="st">&#39;prob&#39;</span>))</span>
<span id="cb116-10"><a href="comp-models.html#cb116-10" aria-hidden="true"></a> Set.Train.ProbClass1.mtx &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;cbind&#39;</span>,</span>
<span id="cb116-11"><a href="comp-models.html#cb116-11" aria-hidden="true"></a>    <span class="kw">lapply</span>(Set.Train.Prob.lst, <span class="cf">function</span>(x) x[,CLASS1]))</span>
<span id="cb116-12"><a href="comp-models.html#cb116-12" aria-hidden="true"></a></span>
<span id="cb116-13"><a href="comp-models.html#cb116-13" aria-hidden="true"></a> <span class="kw">rownames</span>(Set.Train.ProbClass1.mtx) &lt;-<span class="st"> </span><span class="kw">names</span>(Train.Label.vec)</span>
<span id="cb116-14"><a href="comp-models.html#cb116-14" aria-hidden="true"></a></span>
<span id="cb116-15"><a href="comp-models.html#cb116-15" aria-hidden="true"></a> <span class="co"># ROC</span></span>
<span id="cb116-16"><a href="comp-models.html#cb116-16" aria-hidden="true"></a> Set.Train.roc.mtx.lst &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">colnames</span>(Set.Train.ProbClass1.mtx), <span class="cf">function</span>(MM)</span>
<span id="cb116-17"><a href="comp-models.html#cb116-17" aria-hidden="true"></a>    <span class="kw">do.call</span>(<span class="st">&#39;rbind&#39;</span>, <span class="kw">lapply</span>(<span class="kw">rev</span>(<span class="kw">sort</span>(<span class="kw">unique</span>(Set.Train.ProbClass1.mtx))),</span>
<span id="cb116-18"><a href="comp-models.html#cb116-18" aria-hidden="true"></a>     <span class="cf">function</span>(TS) {</span>
<span id="cb116-19"><a href="comp-models.html#cb116-19" aria-hidden="true"></a>        TP &lt;-<span class="st"> </span><span class="kw">sum</span>(Set.Train.ProbClass1.mtx[,MM][Train.Label.vec<span class="op">==</span>CLASS1] <span class="op">&gt;</span><span class="st"> </span>TS, <span class="dt">na.rm=</span>T)</span>
<span id="cb116-20"><a href="comp-models.html#cb116-20" aria-hidden="true"></a>        FP &lt;-<span class="st"> </span><span class="kw">sum</span>(Set.Train.ProbClass1.mtx[,MM][Train.Label.vec<span class="op">==</span>CLASS2] <span class="op">&gt;</span><span class="st"> </span>TS, <span class="dt">na.rm=</span>T)</span>
<span id="cb116-21"><a href="comp-models.html#cb116-21" aria-hidden="true"></a>        <span class="kw">c</span>(<span class="dt">TS=</span>TS, <span class="dt">TP=</span>TP, <span class="dt">FP=</span>FP)}))</span>
<span id="cb116-22"><a href="comp-models.html#cb116-22" aria-hidden="true"></a>   )</span>
<span id="cb116-23"><a href="comp-models.html#cb116-23" aria-hidden="true"></a> <span class="kw">names</span>(Set.Train.roc.mtx.lst) &lt;-<span class="st"> </span><span class="kw">colnames</span>(Set.Train.ProbClass1.mtx)</span>
<span id="cb116-24"><a href="comp-models.html#cb116-24" aria-hidden="true"></a> <span class="co"># Get auc</span></span>
<span id="cb116-25"><a href="comp-models.html#cb116-25" aria-hidden="true"></a> Set.Train.auc.vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(Set.Train.ProbClass1.mtx), <span class="cf">function</span>(CC)</span>
<span id="cb116-26"><a href="comp-models.html#cb116-26" aria-hidden="true"></a>   <span class="kw">auc</span>(Train.Label.vec, Set.Train.ProbClass1.mtx[,CC]))</span>
<span id="cb116-27"><a href="comp-models.html#cb116-27" aria-hidden="true"></a> <span class="kw">names</span>(Set.Train.auc.vec) &lt;-<span class="st"> </span><span class="kw">colnames</span>(Set.Train.ProbClass1.mtx)</span>
<span id="cb116-28"><a href="comp-models.html#cb116-28" aria-hidden="true"></a></span>
<span id="cb116-29"><a href="comp-models.html#cb116-29" aria-hidden="true"></a></span>
<span id="cb116-30"><a href="comp-models.html#cb116-30" aria-hidden="true"></a> <span class="kw">plot</span>(<span class="dt">x=</span><span class="kw">range</span>(<span class="kw">do.call</span>(<span class="st">&#39;c&#39;</span>, <span class="kw">lapply</span>(Set.Train.roc.mtx.lst,</span>
<span id="cb116-31"><a href="comp-models.html#cb116-31" aria-hidden="true"></a>                <span class="cf">function</span>(LL) LL[,<span class="st">&#39;FP&#39;</span>])))<span class="op">/</span><span class="kw">sum</span>(Train.Label.vec<span class="op">==</span>CLASS2),</span>
<span id="cb116-32"><a href="comp-models.html#cb116-32" aria-hidden="true"></a>      <span class="dt">y=</span><span class="kw">range</span>(<span class="kw">do.call</span>(<span class="st">&#39;c&#39;</span>, <span class="kw">lapply</span>(Set.Train.roc.mtx.lst,</span>
<span id="cb116-33"><a href="comp-models.html#cb116-33" aria-hidden="true"></a>                <span class="cf">function</span>(LL) LL[,<span class="st">&#39;TP&#39;</span>])))<span class="op">/</span><span class="kw">sum</span>(Train.Label.vec<span class="op">==</span>CLASS1),</span>
<span id="cb116-34"><a href="comp-models.html#cb116-34" aria-hidden="true"></a>      <span class="dt">xlab=</span><span class="st">&#39;FP&#39;</span>, <span class="dt">ylab=</span><span class="st">&#39;TP&#39;</span>, <span class="dt">type=</span><span class="st">&#39;n&#39;</span>)</span>
<span id="cb116-35"><a href="comp-models.html#cb116-35" aria-hidden="true"></a></span>
<span id="cb116-36"><a href="comp-models.html#cb116-36" aria-hidden="true"></a> <span class="cf">for</span>(II <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(Set.Train.roc.mtx.lst))</span>
<span id="cb116-37"><a href="comp-models.html#cb116-37" aria-hidden="true"></a> <span class="kw">lines</span>(<span class="dt">x=</span>Set.Train.roc.mtx.lst[[II]][,<span class="st">&#39;FP&#39;</span>]<span class="op">/</span><span class="kw">sum</span>(Train.Label.vec<span class="op">==</span>CLASS2),</span>
<span id="cb116-38"><a href="comp-models.html#cb116-38" aria-hidden="true"></a>       <span class="dt">y=</span>Set.Train.roc.mtx.lst[[II]][,<span class="st">&#39;TP&#39;</span>]<span class="op">/</span><span class="kw">sum</span>(Train.Label.vec<span class="op">==</span>CLASS1),</span>
<span id="cb116-39"><a href="comp-models.html#cb116-39" aria-hidden="true"></a>       <span class="dt">col=</span>Model.col[<span class="kw">names</span>(Set.Train.roc.mtx.lst)[II]])</span>
<span id="cb116-40"><a href="comp-models.html#cb116-40" aria-hidden="true"></a> <span class="kw">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="dt">col=</span><span class="st">&#39;grey&#39;</span>)</span>
<span id="cb116-41"><a href="comp-models.html#cb116-41" aria-hidden="true"></a> <span class="kw">legend</span>(<span class="st">&#39;bottomright&#39;</span>,</span>
<span id="cb116-42"><a href="comp-models.html#cb116-42" aria-hidden="true"></a>        <span class="dt">legend=</span><span class="kw">paste</span>(<span class="kw">names</span>(Set.Train.roc.mtx.lst), <span class="st">&#39;:&#39;</span>,</span>
<span id="cb116-43"><a href="comp-models.html#cb116-43" aria-hidden="true"></a>          <span class="kw">round</span>(Set.Train.auc.vec[<span class="kw">names</span>(Set.Train.roc.mtx.lst)],<span class="dv">3</span>),<span class="dt">sep=</span><span class="st">&#39;&#39;</span>),</span>
<span id="cb116-44"><a href="comp-models.html#cb116-44" aria-hidden="true"></a>        <span class="dt">col=</span>Model.col[<span class="kw">names</span>(Set.Train.roc.mtx.lst)],</span>
<span id="cb116-45"><a href="comp-models.html#cb116-45" aria-hidden="true"></a>        <span class="dt">lty=</span><span class="dv">1</span>)</span>
<span id="cb116-46"><a href="comp-models.html#cb116-46" aria-hidden="true"></a> <span class="kw">title</span>(<span class="st">&#39;Model Performance on Train Set&#39;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:comp-models-CompROCTrain"></span>
<img src="Static/figures/comp-models-CompROCTrain-1.png" alt="Training Data ROC" width="1056" />
<p class="caption">
Figure 4.1: Training Data ROC
</p>
</div>
<!-- ######################################################################## -->
</div>
<div id="out-of-fold-train-average-over-repeats" class="section level3" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Out-of-fold Train: Average over Repeats</h3>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="comp-models.html#cb117-1" aria-hidden="true"></a><span class="co">### BREAK CACHE</span></span>
<span id="cb117-2"><a href="comp-models.html#cb117-2" aria-hidden="true"></a> <span class="kw">suppressMessages</span>(<span class="kw">require</span>(pROC))</span>
<span id="cb117-3"><a href="comp-models.html#cb117-3" aria-hidden="true"></a> <span class="co"># Get predicted probabilities</span></span>
<span id="cb117-4"><a href="comp-models.html#cb117-4" aria-hidden="true"></a> Set.ModelFit.osProbClass1.mtx.lst &lt;-<span class="st"> </span><span class="kw">lapply</span>(Set.ModelFit.lst,</span>
<span id="cb117-5"><a href="comp-models.html#cb117-5" aria-hidden="true"></a> <span class="cf">function</span>(MF) {</span>
<span id="cb117-6"><a href="comp-models.html#cb117-6" aria-hidden="true"></a>   MF.pred.mtx &lt;-<span class="st"> </span>MF<span class="op">$</span>pred</span>
<span id="cb117-7"><a href="comp-models.html#cb117-7" aria-hidden="true"></a>   Rep.vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">strsplit</span>(MF<span class="op">$</span>pred<span class="op">$</span>Resample, <span class="dt">split=</span><span class="st">&#39;</span><span class="ch">\\</span><span class="st">.&#39;</span>),<span class="st">&#39;[&#39;</span>, <span class="dv">2</span>)</span>
<span id="cb117-8"><a href="comp-models.html#cb117-8" aria-hidden="true"></a>   rowIndex.vec &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">unique</span>(MF<span class="op">$</span>pred<span class="op">$</span>rowIndex))</span>
<span id="cb117-9"><a href="comp-models.html#cb117-9" aria-hidden="true"></a>   ProbClass1.mtx &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;cbind&#39;</span>, <span class="kw">lapply</span>(<span class="kw">split</span>(MF<span class="op">$</span>pred, Rep.vec),</span>
<span id="cb117-10"><a href="comp-models.html#cb117-10" aria-hidden="true"></a>   <span class="cf">function</span>(RepMFpred.frm)</span>
<span id="cb117-11"><a href="comp-models.html#cb117-11" aria-hidden="true"></a>      RepMFpred.frm[<span class="kw">match</span>(rowIndex.vec, RepMFpred.frm<span class="op">$</span>rowIndex),CLASS1]))</span>
<span id="cb117-12"><a href="comp-models.html#cb117-12" aria-hidden="true"></a>   ProbClass1.mtx})</span>
<span id="cb117-13"><a href="comp-models.html#cb117-13" aria-hidden="true"></a></span>
<span id="cb117-14"><a href="comp-models.html#cb117-14" aria-hidden="true"></a> </span>
<span id="cb117-15"><a href="comp-models.html#cb117-15" aria-hidden="true"></a> <span class="co">#################################</span></span>
<span id="cb117-16"><a href="comp-models.html#cb117-16" aria-hidden="true"></a> <span class="co"># Use average osProb</span></span>
<span id="cb117-17"><a href="comp-models.html#cb117-17" aria-hidden="true"></a> <span class="co">#################################</span></span>
<span id="cb117-18"><a href="comp-models.html#cb117-18" aria-hidden="true"></a> Set.Train.mean_osProbClass1.mtx &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;cbind&#39;</span>, <span class="kw">lapply</span>(Set.ModelFit.osProbClass1.mtx.lst,</span>
<span id="cb117-19"><a href="comp-models.html#cb117-19" aria-hidden="true"></a>  <span class="cf">function</span>(osProbClass1.mtx) <span class="kw">apply</span>(osProbClass1.mtx,<span class="dv">1</span>,mean)))</span>
<span id="cb117-20"><a href="comp-models.html#cb117-20" aria-hidden="true"></a> <span class="kw">rownames</span>(Set.Train.mean_osProbClass1.mtx) &lt;-<span class="st"> </span><span class="kw">names</span>(Train.Label.vec)</span>
<span id="cb117-21"><a href="comp-models.html#cb117-21" aria-hidden="true"></a></span>
<span id="cb117-22"><a href="comp-models.html#cb117-22" aria-hidden="true"></a> <span class="co"># ROC</span></span>
<span id="cb117-23"><a href="comp-models.html#cb117-23" aria-hidden="true"></a>  Set.Train.mean_osProbClass1.roc.mtx.lst &lt;-</span>
<span id="cb117-24"><a href="comp-models.html#cb117-24" aria-hidden="true"></a><span class="st">  </span><span class="kw">lapply</span>(<span class="kw">colnames</span>(Set.Train.mean_osProbClass1.mtx), <span class="cf">function</span>(MM)</span>
<span id="cb117-25"><a href="comp-models.html#cb117-25" aria-hidden="true"></a>   <span class="kw">do.call</span>(<span class="st">&#39;rbind&#39;</span>, <span class="kw">lapply</span>(<span class="kw">rev</span>(<span class="kw">sort</span>(<span class="kw">unique</span>(Set.Train.mean_osProbClass1.mtx))),</span>
<span id="cb117-26"><a href="comp-models.html#cb117-26" aria-hidden="true"></a>    <span class="cf">function</span>(TS) {</span>
<span id="cb117-27"><a href="comp-models.html#cb117-27" aria-hidden="true"></a>     TP &lt;-<span class="st"> </span><span class="kw">sum</span>(Set.Train.mean_osProbClass1.mtx[,MM][Train.Label.vec<span class="op">==</span>CLASS1] <span class="op">&gt;</span><span class="st"> </span>TS, <span class="dt">na.rm=</span>T)</span>
<span id="cb117-28"><a href="comp-models.html#cb117-28" aria-hidden="true"></a>     FP &lt;-<span class="st"> </span><span class="kw">sum</span>(Set.Train.mean_osProbClass1.mtx[,MM][Train.Label.vec<span class="op">==</span>CLASS2] <span class="op">&gt;</span><span class="st"> </span>TS, <span class="dt">na.rm=</span>T)</span>
<span id="cb117-29"><a href="comp-models.html#cb117-29" aria-hidden="true"></a>        <span class="kw">c</span>(<span class="dt">TS=</span>TS, <span class="dt">TP=</span>TP, <span class="dt">FP=</span>FP)}))</span>
<span id="cb117-30"><a href="comp-models.html#cb117-30" aria-hidden="true"></a>   )</span>
<span id="cb117-31"><a href="comp-models.html#cb117-31" aria-hidden="true"></a> <span class="kw">names</span>(Set.Train.mean_osProbClass1.roc.mtx.lst) &lt;-<span class="st"> </span><span class="kw">colnames</span>(Set.Train.mean_osProbClass1.mtx)</span>
<span id="cb117-32"><a href="comp-models.html#cb117-32" aria-hidden="true"></a></span>
<span id="cb117-33"><a href="comp-models.html#cb117-33" aria-hidden="true"></a> <span class="co"># Get auc</span></span>
<span id="cb117-34"><a href="comp-models.html#cb117-34" aria-hidden="true"></a> Set.Train.mean_osProbClass1.auc.vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(Set.Train.mean_osProbClass1.mtx), <span class="cf">function</span>(CC)</span>
<span id="cb117-35"><a href="comp-models.html#cb117-35" aria-hidden="true"></a>   <span class="kw">auc</span>(Train.Label.vec, Set.Train.mean_osProbClass1.mtx[,CC]))</span>
<span id="cb117-36"><a href="comp-models.html#cb117-36" aria-hidden="true"></a> <span class="kw">names</span>(Set.Train.mean_osProbClass1.auc.vec) &lt;-<span class="st"> </span><span class="kw">colnames</span>(Set.Train.mean_osProbClass1.mtx)</span>
<span id="cb117-37"><a href="comp-models.html#cb117-37" aria-hidden="true"></a></span>
<span id="cb117-38"><a href="comp-models.html#cb117-38" aria-hidden="true"></a></span>
<span id="cb117-39"><a href="comp-models.html#cb117-39" aria-hidden="true"></a> <span class="kw">plot</span>(<span class="dt">x=</span><span class="kw">range</span>(<span class="kw">do.call</span>(<span class="st">&#39;c&#39;</span>, <span class="kw">lapply</span>(Set.Train.mean_osProbClass1.roc.mtx.lst,</span>
<span id="cb117-40"><a href="comp-models.html#cb117-40" aria-hidden="true"></a>                <span class="cf">function</span>(LL) LL[,<span class="st">&#39;FP&#39;</span>])))<span class="op">/</span><span class="kw">sum</span>(Train.Label.vec<span class="op">==</span>CLASS2),</span>
<span id="cb117-41"><a href="comp-models.html#cb117-41" aria-hidden="true"></a>      <span class="dt">y=</span><span class="kw">range</span>(<span class="kw">do.call</span>(<span class="st">&#39;c&#39;</span>, <span class="kw">lapply</span>(Set.Train.mean_osProbClass1.roc.mtx.lst,</span>
<span id="cb117-42"><a href="comp-models.html#cb117-42" aria-hidden="true"></a>                <span class="cf">function</span>(LL) LL[,<span class="st">&#39;TP&#39;</span>])))<span class="op">/</span><span class="kw">sum</span>(Train.Label.vec<span class="op">==</span>CLASS1),</span>
<span id="cb117-43"><a href="comp-models.html#cb117-43" aria-hidden="true"></a>      <span class="dt">xlab=</span><span class="st">&#39;FP&#39;</span>, <span class="dt">ylab=</span><span class="st">&#39;TP&#39;</span>, <span class="dt">type=</span><span class="st">&#39;n&#39;</span>)</span>
<span id="cb117-44"><a href="comp-models.html#cb117-44" aria-hidden="true"></a></span>
<span id="cb117-45"><a href="comp-models.html#cb117-45" aria-hidden="true"></a> <span class="cf">for</span>(II <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(Set.Train.mean_osProbClass1.roc.mtx.lst))</span>
<span id="cb117-46"><a href="comp-models.html#cb117-46" aria-hidden="true"></a> <span class="kw">lines</span>(<span class="dt">x=</span>Set.Train.mean_osProbClass1.roc.mtx.lst[[II]][,<span class="st">&#39;FP&#39;</span>]<span class="op">/</span><span class="kw">sum</span>(Train.Label.vec<span class="op">==</span>CLASS2),</span>
<span id="cb117-47"><a href="comp-models.html#cb117-47" aria-hidden="true"></a>       <span class="dt">y=</span>Set.Train.mean_osProbClass1.roc.mtx.lst[[II]][,<span class="st">&#39;TP&#39;</span>]<span class="op">/</span><span class="kw">sum</span>(Train.Label.vec<span class="op">==</span>CLASS1),</span>
<span id="cb117-48"><a href="comp-models.html#cb117-48" aria-hidden="true"></a>       <span class="dt">col=</span>Model.col[<span class="kw">names</span>(Set.Train.roc.mtx.lst)[II]])</span>
<span id="cb117-49"><a href="comp-models.html#cb117-49" aria-hidden="true"></a> <span class="kw">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="dt">col=</span><span class="st">&#39;grey&#39;</span>)</span>
<span id="cb117-50"><a href="comp-models.html#cb117-50" aria-hidden="true"></a> <span class="kw">legend</span>(<span class="st">&#39;bottomright&#39;</span>,</span>
<span id="cb117-51"><a href="comp-models.html#cb117-51" aria-hidden="true"></a>        <span class="dt">legend=</span><span class="kw">paste</span>(<span class="kw">names</span>(Set.Train.mean_osProbClass1.auc.vec), <span class="st">&#39;:&#39;</span>,</span>
<span id="cb117-52"><a href="comp-models.html#cb117-52" aria-hidden="true"></a>          <span class="kw">round</span>(Set.Train.mean_osProbClass1.auc.vec,<span class="dv">3</span>),<span class="dt">sep=</span><span class="st">&#39;&#39;</span>),</span>
<span id="cb117-53"><a href="comp-models.html#cb117-53" aria-hidden="true"></a>        <span class="dt">col=</span>Model.col[<span class="kw">names</span>(Set.Train.mean_osProbClass1.auc.vec)], <span class="dt">lty=</span><span class="dv">1</span>)</span>
<span id="cb117-54"><a href="comp-models.html#cb117-54" aria-hidden="true"></a> <span class="kw">title</span>(<span class="st">&#39;Model Performance on Train Set - Out-of-fold mean Prob(MSS)&#39;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:comp-models-CompROCOOFTrain"></span>
<img src="Static/figures/comp-models-CompROCOOFTrain-1.png" alt="Out-of-fold Train: Average over Repeats" width="1056" />
<p class="caption">
Figure 4.2: Out-of-fold Train: Average over Repeats
</p>
</div>
<!-- ######################################################################## -->
<!-- SKIP AFTER EXAMINING
### Out-of-fold Train Set: Individual Repeats
-->
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="comp-models.html#cb118-1" aria-hidden="true"></a><span class="co">### BREAK CACHE</span></span>
<span id="cb118-2"><a href="comp-models.html#cb118-2" aria-hidden="true"></a> <span class="kw">suppressMessages</span>(<span class="kw">require</span>(pROC))</span>
<span id="cb118-3"><a href="comp-models.html#cb118-3" aria-hidden="true"></a></span>
<span id="cb118-4"><a href="comp-models.html#cb118-4" aria-hidden="true"></a> <span class="co">#################################</span></span>
<span id="cb118-5"><a href="comp-models.html#cb118-5" aria-hidden="true"></a> <span class="co"># Replot ROC keep individual rep osProbClass1</span></span>
<span id="cb118-6"><a href="comp-models.html#cb118-6" aria-hidden="true"></a> <span class="co">#################################</span></span>
<span id="cb118-7"><a href="comp-models.html#cb118-7" aria-hidden="true"></a> Set.Train.indiv_osProbClass1.mtx &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;cbind&#39;</span>, <span class="kw">lapply</span>(<span class="kw">names</span>(Set.ModelFit.osProbClass1.mtx.lst),</span>
<span id="cb118-8"><a href="comp-models.html#cb118-8" aria-hidden="true"></a>  <span class="cf">function</span>(MODEL) {</span>
<span id="cb118-9"><a href="comp-models.html#cb118-9" aria-hidden="true"></a>   osProbClass1.mtx &lt;-<span class="st"> </span>Set.ModelFit.osProbClass1.mtx.lst[[MODEL]]</span>
<span id="cb118-10"><a href="comp-models.html#cb118-10" aria-hidden="true"></a>   <span class="kw">colnames</span>(osProbClass1.mtx) &lt;-<span class="st"> </span><span class="kw">paste</span>(MODEL, <span class="kw">colnames</span>(osProbClass1.mtx),<span class="dt">sep=</span><span class="st">&#39;.&#39;</span>)</span>
<span id="cb118-11"><a href="comp-models.html#cb118-11" aria-hidden="true"></a>   osProbClass1.mtx}))</span>
<span id="cb118-12"><a href="comp-models.html#cb118-12" aria-hidden="true"></a> <span class="kw">rownames</span>(Set.Train.indiv_osProbClass1.mtx) &lt;-<span class="st"> </span><span class="kw">names</span>(Train.Label.vec)</span>
<span id="cb118-13"><a href="comp-models.html#cb118-13" aria-hidden="true"></a></span>
<span id="cb118-14"><a href="comp-models.html#cb118-14" aria-hidden="true"></a> <span class="co"># ROC</span></span>
<span id="cb118-15"><a href="comp-models.html#cb118-15" aria-hidden="true"></a> Set.Train.indiv_osProbClass1.roc.mtx.lst &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">colnames</span>(Set.Train.indiv_osProbClass1.mtx), <span class="cf">function</span>(MM)</span>
<span id="cb118-16"><a href="comp-models.html#cb118-16" aria-hidden="true"></a>    <span class="kw">do.call</span>(<span class="st">&#39;rbind&#39;</span>, <span class="kw">lapply</span>(<span class="kw">rev</span>(<span class="kw">sort</span>(<span class="kw">unique</span>(Set.Train.indiv_osProbClass1.mtx))),</span>
<span id="cb118-17"><a href="comp-models.html#cb118-17" aria-hidden="true"></a>     <span class="cf">function</span>(TS) {</span>
<span id="cb118-18"><a href="comp-models.html#cb118-18" aria-hidden="true"></a>        TP &lt;-<span class="st"> </span><span class="kw">sum</span>(Set.Train.indiv_osProbClass1.mtx[,MM][Train.Label.vec<span class="op">==</span>CLASS1] <span class="op">&gt;</span><span class="st"> </span>TS, <span class="dt">na.rm=</span>T)</span>
<span id="cb118-19"><a href="comp-models.html#cb118-19" aria-hidden="true"></a>        FP &lt;-<span class="st"> </span><span class="kw">sum</span>(Set.Train.indiv_osProbClass1.mtx[,MM][Train.Label.vec<span class="op">==</span>CLASS2] <span class="op">&gt;</span><span class="st"> </span>TS, <span class="dt">na.rm=</span>T)</span>
<span id="cb118-20"><a href="comp-models.html#cb118-20" aria-hidden="true"></a>        <span class="kw">c</span>(<span class="dt">TS=</span>TS, <span class="dt">TP=</span>TP, <span class="dt">FP=</span>FP)}))</span>
<span id="cb118-21"><a href="comp-models.html#cb118-21" aria-hidden="true"></a>   )</span>
<span id="cb118-22"><a href="comp-models.html#cb118-22" aria-hidden="true"></a> <span class="kw">names</span>(Set.Train.indiv_osProbClass1.roc.mtx.lst) &lt;-<span class="st"> </span><span class="kw">colnames</span>(Set.Train.indiv_osProbClass1.mtx)</span>
<span id="cb118-23"><a href="comp-models.html#cb118-23" aria-hidden="true"></a></span>
<span id="cb118-24"><a href="comp-models.html#cb118-24" aria-hidden="true"></a></span>
<span id="cb118-25"><a href="comp-models.html#cb118-25" aria-hidden="true"></a> <span class="co"># Get auc</span></span>
<span id="cb118-26"><a href="comp-models.html#cb118-26" aria-hidden="true"></a> Set.Train.indiv_osProbClass1.auc.vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(Set.Train.indiv_osProbClass1.mtx), <span class="cf">function</span>(CC)</span>
<span id="cb118-27"><a href="comp-models.html#cb118-27" aria-hidden="true"></a>   <span class="kw">auc</span>(Train.Label.vec, Set.Train.indiv_osProbClass1.mtx[,CC]))</span>
<span id="cb118-28"><a href="comp-models.html#cb118-28" aria-hidden="true"></a> <span class="kw">names</span>(Set.Train.indiv_osProbClass1.auc.vec) &lt;-<span class="st"> </span><span class="kw">colnames</span>(Set.Train.indiv_osProbClass1.mtx)</span>
<span id="cb118-29"><a href="comp-models.html#cb118-29" aria-hidden="true"></a></span>
<span id="cb118-30"><a href="comp-models.html#cb118-30" aria-hidden="true"></a> Set.Train.mean_indiv_osProbClass1.auc.vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">split</span>(Set.Train.indiv_osProbClass1.auc.vec,</span>
<span id="cb118-31"><a href="comp-models.html#cb118-31" aria-hidden="true"></a>   <span class="kw">sapply</span>(<span class="kw">strsplit</span>(<span class="kw">names</span>(Set.Train.indiv_osProbClass1.auc.vec), <span class="dt">split=</span><span class="st">&#39;</span><span class="ch">\\</span><span class="st">.&#39;</span>),<span class="st">&#39;[&#39;</span>,<span class="dv">1</span>)),</span>
<span id="cb118-32"><a href="comp-models.html#cb118-32" aria-hidden="true"></a>   mean)</span></code></pre></div>
<!-- ######################################################################## -->
</div>
<div id="compare-predicted-probabilities" class="section level3" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Compare Predicted Probabilities</h3>
<p>With the repeated CV fitting set-up, we can examine the distribution of out-of-sample
predictions. This is useful to both characterize the mode of errors occuring
in a given model - are the errors due to bias or variability? - as well as
chracterizing samples - some samples may be mis-labelled or hard to
classify correctly.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="comp-models.html#cb119-1" aria-hidden="true"></a><span class="co">### BREAK CACHE</span></span>
<span id="cb119-2"><a href="comp-models.html#cb119-2" aria-hidden="true"></a>  <span class="cf">if</span>(<span class="kw">sum</span>(<span class="kw">rownames</span>(Set.Train.indiv_osProbClass1.mtx) <span class="op">!=</span></span>
<span id="cb119-3"><a href="comp-models.html#cb119-3" aria-hidden="true"></a><span class="st">         </span><span class="kw">names</span>(Train.Label.vec)))</span>
<span id="cb119-4"><a href="comp-models.html#cb119-4" aria-hidden="true"></a>  <span class="kw">stop</span>(<span class="st">&quot;Sample ordering problem.&quot;</span>)</span>
<span id="cb119-5"><a href="comp-models.html#cb119-5" aria-hidden="true"></a></span>
<span id="cb119-6"><a href="comp-models.html#cb119-6" aria-hidden="true"></a>  <span class="co"># Reorder by Outcome</span></span>
<span id="cb119-7"><a href="comp-models.html#cb119-7" aria-hidden="true"></a>  row.o &lt;-<span class="st"> </span><span class="kw">order</span>(Train.Label.vec, <span class="kw">names</span>(Train.Label.vec))</span>
<span id="cb119-8"><a href="comp-models.html#cb119-8" aria-hidden="true"></a></span>
<span id="cb119-9"><a href="comp-models.html#cb119-9" aria-hidden="true"></a>  Col.Models.vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">strsplit</span>(<span class="kw">colnames</span>(Set.Train.indiv_osProbClass1.mtx), <span class="dt">split=</span><span class="st">&#39;</span><span class="ch">\\</span><span class="st">.&#39;</span>),<span class="st">&#39;[&#39;</span>,<span class="dv">1</span>)</span>
<span id="cb119-10"><a href="comp-models.html#cb119-10" aria-hidden="true"></a></span>
<span id="cb119-11"><a href="comp-models.html#cb119-11" aria-hidden="true"></a>  <span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="kw">length</span>(<span class="kw">unique</span>(Col.Models.vec)),<span class="dv">1</span>), <span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="dt">oma=</span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb119-12"><a href="comp-models.html#cb119-12" aria-hidden="true"></a></span>
<span id="cb119-13"><a href="comp-models.html#cb119-13" aria-hidden="true"></a>  <span class="cf">for</span>(MOD <span class="cf">in</span> <span class="kw">unique</span>(Col.Models.vec)) {</span>
<span id="cb119-14"><a href="comp-models.html#cb119-14" aria-hidden="true"></a>   Mod.cols &lt;-<span class="st"> </span><span class="kw">which</span>(Col.Models.vec<span class="op">==</span>MOD)</span>
<span id="cb119-15"><a href="comp-models.html#cb119-15" aria-hidden="true"></a></span>
<span id="cb119-16"><a href="comp-models.html#cb119-16" aria-hidden="true"></a>   box.out &lt;-</span>
<span id="cb119-17"><a href="comp-models.html#cb119-17" aria-hidden="true"></a><span class="st">   </span><span class="kw">boxplot</span>(<span class="kw">t</span>(Set.Train.indiv_osProbClass1.mtx[row.o,Mod.cols]),</span>
<span id="cb119-18"><a href="comp-models.html#cb119-18" aria-hidden="true"></a>           <span class="dt">col=</span><span class="kw">ifelse</span>(Train.Label.vec[row.o]<span class="op">==</span>CLASS1,<span class="dv">3</span>,<span class="dv">2</span>),</span>
<span id="cb119-19"><a href="comp-models.html#cb119-19" aria-hidden="true"></a>           <span class="dt">xaxt=</span><span class="st">&#39;n&#39;</span>, <span class="dt">outline=</span>F)</span>
<span id="cb119-20"><a href="comp-models.html#cb119-20" aria-hidden="true"></a>   <span class="kw">title</span>(MOD)</span>
<span id="cb119-21"><a href="comp-models.html#cb119-21" aria-hidden="true"></a>  }</span></code></pre></div>
<div class="figure"><span id="fig:comp-models-CompOOFSet-TrainProbClass1"></span>
<img src="Static/figures/comp-models-CompOOFSet-TrainProbClass1-1.png" alt="Predicted Probabilities" width="1152" />
<p class="caption">
Figure 4.3: Predicted Probabilities
</p>
</div>
<!-- ######################################################################## -->
</div>
<div id="compare-predicted-probabilities---test-set" class="section level3" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> Compare Predicted Probabilities - Test Set</h3>
<p>TO DO</p>
</div>
</div>
<div id="look-at-variable-importance" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Look at Variable Importance</h2>
<p>The <code>caret</code> package provides methods to extract variable importance through
the <a href="">varImp</a> function. Here we will extract these assessments
for each model and compare with genes which have been identified as associated with
MSS status in other studies:</p>
<ul>
<li>BANERJEA <span class="citation">[<a href="references.html#ref-Banerjea:2004aa" role="doc-biblioref">21</a>]</span></li>
<li>CROCE <span class="citation">[<a href="references.html#ref-CROCE" role="doc-biblioref">22</a>]</span></li>
<li>JORISSEN <span class="citation">[<a href="references.html#ref-Jorissen:2009aa" role="doc-biblioref">23</a>]</span></li>
<li>KOINUMA <span class="citation">[<a href="references.html#ref-Koinuma:2005aa" role="doc-biblioref">24</a>]</span></li>
<li>KRUHOFFER <span class="citation">[<a href="references.html#ref-Kruhoffer:2005aa" role="doc-biblioref">25</a>]</span></li>
<li>MORI <span class="citation">[<a href="references.html#ref-Mori:2003aa" role="doc-biblioref">26</a>]</span></li>
</ul>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="comp-models.html#cb120-1" aria-hidden="true"></a><span class="co">### BREAK CACHE</span></span>
<span id="cb120-2"><a href="comp-models.html#cb120-2" aria-hidden="true"></a>  MSSMSI.GeneSets.frm &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">file=</span><span class="kw">file.path</span>(<span class="st">&#39;extData&#39;</span>, <span class="st">&quot;ColonCancerGeneSets.tab&quot;</span>),</span>
<span id="cb120-3"><a href="comp-models.html#cb120-3" aria-hidden="true"></a>   <span class="dt">header=</span>T, <span class="dt">sep=</span><span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span>)</span>
<span id="cb120-4"><a href="comp-models.html#cb120-4" aria-hidden="true"></a></span>
<span id="cb120-5"><a href="comp-models.html#cb120-5" aria-hidden="true"></a>  GeneSets.lst &lt;-<span class="st"> </span><span class="kw">split</span>(MSSMSI.GeneSets.frm<span class="op">$</span>GeneSymbol, <span class="kw">toupper</span>(MSSMSI.GeneSets.frm<span class="op">$</span>ListName))</span>
<span id="cb120-6"><a href="comp-models.html#cb120-6" aria-hidden="true"></a>  GeneSets.lst &lt;-<span class="st"> </span>GeneSets.lst[<span class="kw">c</span>(<span class="st">&#39;BANERJEA&#39;</span>,<span class="st">&#39;CROCE&#39;</span>,<span class="st">&#39;JORISSEN&#39;</span>, <span class="st">&#39;KOINUMA&#39;</span>, <span class="st">&#39;KRUHOFFER&#39;</span>,<span class="st">&#39;MORI&#39;</span>)]</span></code></pre></div>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="comp-models.html#cb121-1" aria-hidden="true"></a><span class="co">### BREAK CACHE</span></span>
<span id="cb121-2"><a href="comp-models.html#cb121-2" aria-hidden="true"></a> <span class="kw">suppressMessages</span>(<span class="kw">require</span>(caret))</span>
<span id="cb121-3"><a href="comp-models.html#cb121-3" aria-hidden="true"></a> <span class="kw">suppressMessages</span>(<span class="kw">require</span>(gbm))</span>
<span id="cb121-4"><a href="comp-models.html#cb121-4" aria-hidden="true"></a></span>
<span id="cb121-5"><a href="comp-models.html#cb121-5" aria-hidden="true"></a> <span class="co"># Load gene to probe set map</span></span>
<span id="cb121-6"><a href="comp-models.html#cb121-6" aria-hidden="true"></a> <span class="kw">load</span>(<span class="dt">file=</span><span class="kw">file.path</span>(<span class="st">&#39;RData&#39;</span>, <span class="st">&#39;GeneNameMap.vec&#39;</span>))</span>
<span id="cb121-7"><a href="comp-models.html#cb121-7" aria-hidden="true"></a> </span>
<span id="cb121-8"><a href="comp-models.html#cb121-8" aria-hidden="true"></a> <span class="co"># Will also need the inverted map</span></span>
<span id="cb121-9"><a href="comp-models.html#cb121-9" aria-hidden="true"></a> GeneNameMap2.vec &lt;-<span class="st"> </span><span class="kw">names</span>(GeneNameMap.vec)</span>
<span id="cb121-10"><a href="comp-models.html#cb121-10" aria-hidden="true"></a> <span class="kw">names</span>(GeneNameMap2.vec) &lt;-<span class="st"> </span>GeneNameMap.vec</span>
<span id="cb121-11"><a href="comp-models.html#cb121-11" aria-hidden="true"></a></span>
<span id="cb121-12"><a href="comp-models.html#cb121-12" aria-hidden="true"></a>  Set.ModelFit.Top30.lst &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">setdiff</span>(<span class="kw">names</span>(Set.ModelFit.lst),</span>
<span id="cb121-13"><a href="comp-models.html#cb121-13" aria-hidden="true"></a>                                   <span class="kw">c</span>(<span class="st">&quot;knnFit&quot;</span>,<span class="st">&quot;sddaLDAFit&quot;</span>,<span class="st">&quot;sddaQDAFit&quot;</span>)),</span>
<span id="cb121-14"><a href="comp-models.html#cb121-14" aria-hidden="true"></a>  <span class="cf">function</span>(MOD) {</span>
<span id="cb121-15"><a href="comp-models.html#cb121-15" aria-hidden="true"></a>    <span class="co">#cat(MOD,&#39;\n&#39;)</span></span>
<span id="cb121-16"><a href="comp-models.html#cb121-16" aria-hidden="true"></a>    FIT &lt;-<span class="st"> </span>Set.ModelFit.lst[[MOD]]</span>
<span id="cb121-17"><a href="comp-models.html#cb121-17" aria-hidden="true"></a></span>
<span id="cb121-18"><a href="comp-models.html#cb121-18" aria-hidden="true"></a>    <span class="cf">if</span>(<span class="kw">is.element</span>(CLASS1, <span class="kw">colnames</span>(<span class="kw">varImp</span>(FIT)<span class="op">$</span>imp)))</span>
<span id="cb121-19"><a href="comp-models.html#cb121-19" aria-hidden="true"></a>    impVar.vec &lt;-<span class="st"> </span><span class="kw">varImp</span>(FIT)<span class="op">$</span>imp[,CLASS1] <span class="cf">else</span></span>
<span id="cb121-20"><a href="comp-models.html#cb121-20" aria-hidden="true"></a>    impVar.vec &lt;-<span class="st"> </span><span class="kw">varImp</span>(FIT)<span class="op">$</span>imp<span class="op">$</span>Overall</span>
<span id="cb121-21"><a href="comp-models.html#cb121-21" aria-hidden="true"></a></span>
<span id="cb121-22"><a href="comp-models.html#cb121-22" aria-hidden="true"></a>    top30.ndx &lt;-<span class="st"> </span><span class="kw">rev</span>(<span class="kw">order</span>(impVar.vec))[<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>]</span>
<span id="cb121-23"><a href="comp-models.html#cb121-23" aria-hidden="true"></a>    varImp.vec &lt;-<span class="st"> </span>impVar.vec[top30.ndx]</span>
<span id="cb121-24"><a href="comp-models.html#cb121-24" aria-hidden="true"></a>    <span class="kw">names</span>(varImp.vec) &lt;-<span class="st"> </span><span class="kw">rownames</span>(<span class="kw">varImp</span>(FIT)<span class="op">$</span>imp)[top30.ndx]</span>
<span id="cb121-25"><a href="comp-models.html#cb121-25" aria-hidden="true"></a>    varImp.vec</span>
<span id="cb121-26"><a href="comp-models.html#cb121-26" aria-hidden="true"></a>    })</span>
<span id="cb121-27"><a href="comp-models.html#cb121-27" aria-hidden="true"></a>  <span class="kw">names</span>(Set.ModelFit.Top30.lst) &lt;-<span class="st"> </span><span class="kw">setdiff</span>(<span class="kw">names</span>(Set.ModelFit.lst),</span>
<span id="cb121-28"><a href="comp-models.html#cb121-28" aria-hidden="true"></a>                                   <span class="kw">c</span>(<span class="st">&quot;knnFit&quot;</span>,<span class="st">&quot;sddaLDAFit&quot;</span>,<span class="st">&quot;sddaQDAFit&quot;</span>))</span>
<span id="cb121-29"><a href="comp-models.html#cb121-29" aria-hidden="true"></a></span>
<span id="cb121-30"><a href="comp-models.html#cb121-30" aria-hidden="true"></a>  Top30.Name.vec &lt;-<span class="st"> </span><span class="kw">unique</span>(<span class="kw">do.call</span>(<span class="st">&#39;c&#39;</span>, <span class="kw">lapply</span>(Set.ModelFit.Top30.lst, <span class="cf">function</span>(VV) <span class="kw">names</span>(VV))))</span>
<span id="cb121-31"><a href="comp-models.html#cb121-31" aria-hidden="true"></a></span>
<span id="cb121-32"><a href="comp-models.html#cb121-32" aria-hidden="true"></a>  Top30.ProbeId.vec &lt;-<span class="st"> </span>GeneNameMap.vec[Top30.Name.vec]</span>
<span id="cb121-33"><a href="comp-models.html#cb121-33" aria-hidden="true"></a></span>
<span id="cb121-34"><a href="comp-models.html#cb121-34" aria-hidden="true"></a>  <span class="co"># Put together in a matrix</span></span>
<span id="cb121-35"><a href="comp-models.html#cb121-35" aria-hidden="true"></a>  Top30.varImp.mtx &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;cbind&#39;</span>, <span class="kw">lapply</span>(Set.ModelFit.Top30.lst,</span>
<span id="cb121-36"><a href="comp-models.html#cb121-36" aria-hidden="true"></a>   <span class="cf">function</span>(LL) LL[Top30.Name.vec]))</span>
<span id="cb121-37"><a href="comp-models.html#cb121-37" aria-hidden="true"></a>  <span class="kw">rownames</span>(Top30.varImp.mtx) &lt;-<span class="st"> </span>GeneNameMap.vec[Top30.Name.vec]</span>
<span id="cb121-38"><a href="comp-models.html#cb121-38" aria-hidden="true"></a>  Top30.varImp.mtx[<span class="kw">is.na</span>(Top30.varImp.mtx)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb121-39"><a href="comp-models.html#cb121-39" aria-hidden="true"></a></span>
<span id="cb121-40"><a href="comp-models.html#cb121-40" aria-hidden="true"></a>  <span class="co"># Reoder by ovrall importance</span></span>
<span id="cb121-41"><a href="comp-models.html#cb121-41" aria-hidden="true"></a>  varImp.med.vec &lt;-<span class="st"> </span><span class="kw">apply</span>(Top30.varImp.mtx,<span class="dv">1</span>,median)</span>
<span id="cb121-42"><a href="comp-models.html#cb121-42" aria-hidden="true"></a>  Top30.varImp.mtx &lt;-<span class="st"> </span>Top30.varImp.mtx[<span class="kw">rev</span>(<span class="kw">order</span>(varImp.med.vec)),]</span>
<span id="cb121-43"><a href="comp-models.html#cb121-43" aria-hidden="true"></a></span>
<span id="cb121-44"><a href="comp-models.html#cb121-44" aria-hidden="true"></a></span>
<span id="cb121-45"><a href="comp-models.html#cb121-45" aria-hidden="true"></a>  Top30.varImp.frm &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">PROBEID=</span><span class="kw">rownames</span>(Top30.varImp.mtx), </span>
<span id="cb121-46"><a href="comp-models.html#cb121-46" aria-hidden="true"></a>                                 <span class="dt">Gene=</span>GeneNameMap2.vec[<span class="kw">rownames</span>(Top30.varImp.mtx)],</span>
<span id="cb121-47"><a href="comp-models.html#cb121-47" aria-hidden="true"></a>                                 <span class="kw">round</span>(Top30.varImp.mtx))</span>
<span id="cb121-48"><a href="comp-models.html#cb121-48" aria-hidden="true"></a>  <span class="kw">names</span>(Top30.varImp.frm) &lt;-<span class="st"> </span><span class="kw">sub</span>(<span class="st">&#39;Fit&#39;</span>, <span class="st">&#39;&#39;</span>, <span class="kw">names</span>(Top30.varImp.frm))</span>
<span id="cb121-49"><a href="comp-models.html#cb121-49" aria-hidden="true"></a></span>
<span id="cb121-50"><a href="comp-models.html#cb121-50" aria-hidden="true"></a></span>
<span id="cb121-51"><a href="comp-models.html#cb121-51" aria-hidden="true"></a></span>
<span id="cb121-52"><a href="comp-models.html#cb121-52" aria-hidden="true"></a>  <span class="co"># Add geneset membership</span></span>
<span id="cb121-53"><a href="comp-models.html#cb121-53" aria-hidden="true"></a>  Top30Genes.vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">strsplit</span>(Top30.varImp.frm<span class="op">$</span>Gene, <span class="dt">split=</span><span class="st">&#39;</span><span class="ch">\\</span><span class="st">.&#39;</span>),<span class="st">&#39;[&#39;</span>,<span class="dv">1</span>)</span>
<span id="cb121-54"><a href="comp-models.html#cb121-54" aria-hidden="true"></a></span>
<span id="cb121-55"><a href="comp-models.html#cb121-55" aria-hidden="true"></a>  Top30GeneSetElements.frm &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">do.call</span>(<span class="st">&#39;cbind&#39;</span>, <span class="kw">lapply</span>(GeneSets.lst,</span>
<span id="cb121-56"><a href="comp-models.html#cb121-56" aria-hidden="true"></a>  <span class="cf">function</span>(GS) <span class="kw">ifelse</span>(<span class="kw">is.element</span>(Top30Genes.vec, GS),<span class="st">&#39;Y&#39;</span>,<span class="st">&#39;&#39;</span>))))</span>
<span id="cb121-57"><a href="comp-models.html#cb121-57" aria-hidden="true"></a>  <span class="kw">colnames</span>(Top30GeneSetElements.frm) &lt;-<span class="st"> </span><span class="kw">names</span>(GeneSets.lst)</span>
<span id="cb121-58"><a href="comp-models.html#cb121-58" aria-hidden="true"></a></span>
<span id="cb121-59"><a href="comp-models.html#cb121-59" aria-hidden="true"></a>  Top30.varImp.frm &lt;-<span class="st"> </span><span class="kw">data.frame</span>(Top30.varImp.frm, Top30GeneSetElements.frm)</span>
<span id="cb121-60"><a href="comp-models.html#cb121-60" aria-hidden="true"></a></span>
<span id="cb121-61"><a href="comp-models.html#cb121-61" aria-hidden="true"></a>  o.v &lt;-<span class="st"> </span><span class="kw">rev</span>(<span class="kw">order</span>(<span class="kw">apply</span>(Top30.varImp.frm[,<span class="kw">sub</span>(<span class="st">&#39;Fit&#39;</span>,<span class="st">&#39;&#39;</span>,<span class="kw">names</span>(Set.ModelFit.Top30.lst))],</span>
<span id="cb121-62"><a href="comp-models.html#cb121-62" aria-hidden="true"></a>           <span class="dv">1</span>, mean)))</span>
<span id="cb121-63"><a href="comp-models.html#cb121-63" aria-hidden="true"></a></span>
<span id="cb121-64"><a href="comp-models.html#cb121-64" aria-hidden="true"></a></span>
<span id="cb121-65"><a href="comp-models.html#cb121-65" aria-hidden="true"></a></span>
<span id="cb121-66"><a href="comp-models.html#cb121-66" aria-hidden="true"></a>  DT<span class="op">::</span><span class="kw">datatable</span>(Top30.varImp.frm[o.v,] <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>PROBEID), <span class="dt">rownames=</span>F,</span>
<span id="cb121-67"><a href="comp-models.html#cb121-67" aria-hidden="true"></a>    <span class="dt">caption=</span><span class="st">&quot;Top 30 Features&quot;</span>) </span></code></pre></div>
<div id="htmlwidget-c2834af1a4d4ac1d52c9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-c2834af1a4d4ac1d52c9">{"x":{"filter":"none","caption":"<caption>Top 30 Features<\/caption>","data":[["CBX5.2","RBM6.2","X239131_at","STRN3.1","TOB1.1","RPL22L1","CDC42SE1.2","X232541_at","X230958_s_at","X227556_at","SAMD12.1","TMEM106B.1","X235652_at","SRSF6","PRELID3B.2","PDK3.4","ZBTB20.3","X242277_at","X230002_at","SYK.3","X239449_at","FTX.1","ATP9A","X230291_s_at","TRIM13.2","X232058_at","SEMA5A","X237180_at","AMFR","EIF5A","PCMTD1.1","IGF1R.1","MTA2","IQGAP3.1","X227260_at","X228498_at","MACC1","ITCH.4","ZMYM2.2","PLCB4","X1562750_at","OPN5","EFCAB13.1","X1557803_at","X244226_s_at","TOR1AIP2.6","RNF144B.1","RASAL2.2","MYO5A.3","GYPE","X243990_at","LOC102546299","NRL","ZBBX","CTC1.1","L1TD1","X224350_at","ELP5","RLN2","BAGE.1","SNCA","STOX1","GSX1","L3MBTL1","X237824_at","APELA","HSD17B12","X234161_at","HSD11B1.AS1","X243918_at","FAM124A.4","PRSS33.1","LINC02273","LOC100272217","AFFX.TrpnX.M_at","AFFX.TrpnX.5_at","AFFX.TrpnX.3_at","AFFX.ThrX.M_at","AFFX.r2.Bs.thr.3_s_at","AFFX.r2.Bs.phe.M_at","AFFX.r2.Bs.phe.5_at","AFFX.r2.Bs.lys.M_at","AFFX.r2.Bs.lys.5_at","AFFX.r2.Bs.dap.M_at","AFFX.r2.Bs.dap.5_at","AFFX.r2.Bs.dap.3_at","AFFX.PheX.M_at","AFFX.M27830_5_at","AFFX.HUMRGE.M10098_M_at","AFFX.HUMRGE.M10098_5_at","AFFX.HUMRGE.M10098_3_at","STAT1.4","STAT1.3","AFFX.DapX.3_at","LRTM1.1","RBM12B.2","DTX3.4","WHRN.1","RUBCNL.1","PPP1R16B.2"],[100,76,58,14,39,39,0,26,37,30,11,22,0,28,19,0,0,0,29,0,0,0,1,0,1,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[100,41,52,14,14,29,98,0,4,11,0,0,0,0,8,0,0,0,0,0,0,0,5,0,3,0,0,0,0,0,0,0,5,0,3,0,0,0,0,0,6,4,2,0,5,3,3,3,0,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[100,58,24,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[100,93,87,61,74,61,48,69,78,76,69,71,53,60,55,57,62,56,66,53,53,56,51,0,50,53,49,0,0,0,51,0,0,0,50,52,0,49,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[57,73,59,95,74,66,58,85,49,48,70,49,100,50,50,64,50,53,0,46,41,0,0,58,0,0,0,40,43,0,63,76,53,51,0,0,51,0,42,39,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[100,99,100,94,92,93,89,92,96,91,91,93,87,90,92,90,89,89,92,90,87,90,88,87,88,87,88,89,87,87,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[100,99,100,94,92,93,89,92,96,91,91,93,87,90,92,90,89,89,92,90,87,90,88,87,88,87,88,89,87,87,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[100,5,6,19,2,1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,2,4,6,0,0,0,0,3,0,0,0,0,0,0,0,0,0,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],["","","","","","","","","","","","","","","","","","","","","","","Y","","","","","","Y","Y","","","Y","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","Y","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","Y","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","Y","","","","","","","","","","Y","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Gene<\/th>\n      <th>enet<\/th>\n      <th>gbm<\/th>\n      <th>glmnet<\/th>\n      <th>pam<\/th>\n      <th>rf<\/th>\n      <th>stepLDA<\/th>\n      <th>svmRadial<\/th>\n      <th>xgbLinear<\/th>\n      <th>BANERJEA<\/th>\n      <th>CROCE<\/th>\n      <th>JORISSEN<\/th>\n      <th>KOINUMA<\/th>\n      <th>KRUHOFFER<\/th>\n      <th>MORI<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<!-- THIS IS ALSO TRUNCATED
Table was truncated - display table without search tool.
-->
</div>
<div id="classification-discussion" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Classification: Discussion</h2>
<ul>
<li>Nearest shrunken centroids does well
<ul>
<li>The <a href="http://statweb.stanford.edu/~tibs/PAM/">nearest shrunken centriod</a>
method described in Tibshirani et. al. [Tibshirani:2002aa] does very well
both in terms of classification accuracy, computing time and simplicity
of predictor. This has been our experience with many classification
problems based on gene expression data.</li>
</ul></li>
<li>Lack of agreement with literature gene sets
<ul>
<li>The variable importance assessment shows that the genes which
are deemed important in the clsssifiers the we fitted
have little overlap with the gene sets previously identified
as being associated with MSS status. This is not a problem if we just want to
build a classifier which predicts well. It is somewhat of a problem
if we want to use biology to validate our empirically determined models.
In that respect, the lack of agreement of gene lists across analyses
is always a problem to contend with (see
<span class="citation">[<a href="references.html#ref-Haury:2011aa" role="doc-biblioref">27</a>–<a href="references.html#ref-Meinshausen:2010aa" role="doc-biblioref">34</a>]</span>).</li>
</ul></li>
<li>Models could be better optimized
<ul>
<li>Note that we did not attempt to optimize the model tuning parameters in
any way and just used the default search grids for each model. While
this may be a good choice on average, better performance could be
obtained from some of the models by specifying a tuning parameter
space which is better suited to the problem at hand. This requires
a good understanding of each model and is beyond the scope of this
vignette.</li>
</ul></li>
<li>glmnet/lasso fit
<ul>
<li>the glmnet fit selects a lasso fit by cv. The fit
implicitly selects very few features and produces optimistic
out-of-fold assessments of porformance. This is typical in
small sample size settings.</li>
</ul></li>
<li>auc alone can be mieleading
<ul>
<li>ROC plots AUC are similar for enetFit and glmnetFit, but Figure
<a href="comp-models.html#fig:comp-models-CompOOFSet-TrainProbClass1">4.3</a> shows that the enetFit
model provides better separation between samples belonging to the two classes.
These two assessments should be examined as a set.</li>
</ul></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="train-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="clustering.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ExploreCRC.pdf", "ExploreCRC.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
